{% extends "base.html" %}

{% block title %}{{ manifest.page_config.title }} - LLM-BioEval{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/article_styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/component_styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/layout_styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/section_export.css') }}">
{% if page_specific_css %}
<link rel="stylesheet" href="{{ url_for('static', filename=page_specific_css) }}">
{% endif %}
<style>
/* Simplified layout with consistent spacing */
html, body {
    margin: 0;
    padding: 0;
    overflow-x: hidden !important;
    width: 100%;
    max-width: 100vw;
}

/* Main content wrapper with no spacing */
.main-content {
    margin: 0;
    padding: 0;
}

/* No spacing between sections */
.page-section {
    margin: 0;
    padding: 0;
}

/* Full-width sections with tight padding */
.section-callout {
    width: 100vw !important;
    position: relative !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    padding: 16px 0 !important;
    margin: 0 !important;
    overflow: visible !important;
}

/* Article containers with no vertical padding */
.article-container {
    max-width: 1500px;
    margin: 0 auto;
    padding: 0 48px;
    box-sizing: border-box;
    position: relative;
    left: -148px; /* Shift container left to align with hero */
}

/* Align article content with hero title */
.article-main {
    margin-left: 0; /* Remove any left margin */
    padding-left: 0; /* Remove any left padding */
}

/* Remove gaps between sections */
.page-section + .page-section {
    margin-top: 38px;
}

/* Also remove paragraph margins at section boundaries */
.article-container > *:last-child,
.article-section-spacing > *:last-child,
.callout-content > *:last-child {
    margin-bottom: 0 !important;
}

.article-container > *:first-child,
.article-section-spacing > *:first-child {
    margin-top: 0 !important;
}

/* Remove all component-specific margins */
.top-performers-section,
.worst-performers-section,
.article-section-spacing,
.article-content > *:first-child {
    margin-top: 0 !important;
}

.article-section-spacing {
    margin-bottom: 0 !important;
}
/* Ensure the content wrapper aligns with article content */
.section-callout__content {
    max-width: 1500px; /* Same as article container */
    margin: 0 auto;
    padding: 0 48px; /* Same padding as hero and article */
    box-sizing: border-box; /* Include padding in width calculation */
    overflow-x: visible; /* Don't hide overflow */
}

/* Reset all margins and padding for consistent alignment */
.section-callout__header {
    margin: 0 0 32px 0 !important; /* Only bottom margin */
    padding: 0 !important;
    max-width: none !important; /* Let content determine width */
}

.section-callout__title {
    margin: 0 0 8px 0 !important; /* Only bottom margin */
    padding: 0 !important;
    text-align: left !important;
}

.section-callout__text {
    margin: 0 0 24px 0 !important; /* Only bottom margin */
    padding: 0 !important;
    text-align: left !important;
}

/* Ensure flow diagrams align with header */
.section-callout .flow-diagram-wrapper {
    margin: 0 !important;
    padding: 0 !important;
}

.section-callout .flow-diagram {
    justify-content: flex-start !important; /* Align to start like header */
}

/* Full width variant for content that needs more space */
.section-callout__content--full-width {
    max-width: 1800px;
    padding: 0 48px;
}
/* Fix flow diagram to display horizontally */
.flow-diagram {
    flex-wrap: nowrap !important; /* Keep in one row */
    justify-content: flex-start !important; /* Align left */
    gap: 20px !important;
    padding: 20px 0;
    box-sizing: border-box;
}

/* Allow flow diagram to wrap on small screens */
@media (max-width: 900px) {
    .flow-diagram {
        flex-wrap: wrap !important;
    }
}

/* Ensure all elements use border-box */
.section-callout * {
    box-sizing: border-box;
}
/* Ensure flow boxes don't shrink */
.flow-box {
    flex-shrink: 0;
}
/* Allow flow diagram to use available space */
.section-callout .flow-diagram-wrapper {
    margin: 0;
    padding: 0;
}
/* Ensure no white gaps on edges */
.section-callout::before,
.section-callout::after {
    content: '';
    position: absolute;
    top: 0;
    bottom: 0;
    width: 50vw;
    background: inherit;
}
.section-callout::before {
    right: 100%;
}
.section-callout::after {
    left: 100%;
}

/* Customize Paper Info box width */
.article-sidebar {
    width: 350px; /* Increase from default width */
    min-width: 350px; /* Ensure minimum width */
}

.paper-info-card {
    width: 100%; /* Use full sidebar width */
    min-width: 320px; /* Minimum width for the card */
}

/* CSS Variables */
:root {
    --padding-container: 48px;
    --callout-indent: 120px;
    /* Reduce the left gutter globally on desktop (48px base âˆ’ 24px = 24px) */
    --content-left-bias: -24px;
}

@media (max-width: 1200px) {
    :root {
        --content-left-bias: 0px; /* keep mobile comfy */
    }
}

@media (max-width: 768px) {
    :root { 
        --callout-indent: 20px;
    }
}

.callout,
.callout-definition,
.callout-template,
.callout-compact {
    margin-left: var(--callout-indent) !important;
    width: calc(100% - var(--callout-indent)) !important;
    max-width: calc(100% - var(--callout-indent)) !important;
    min-width: 0 !important;          /* allow shrink in grid */
    box-sizing: border-box !important; /* include padding in width calc */
}

/* Customize article content width */
.article-container {
    max-width: 1200px; /* Adjust this to control article width */
    left: 0 !important; /* Prevent off-screen shift */
}

.article-content {
    max-width: 850px; /* Align with hero content width */
    width: 100%;
    margin-left: 0; /* Remove any left margin */
    padding-left: 0; /* Remove any left padding */
    min-width: 0 !important; /* Allow shrinking on small screens */
}

.article-section-spacing {
    max-width: 850px; /* Control article content sections */
    width: 100%;
    min-width: 0 !important; /* Allow shrinking on small screens */
}

/* Customize main article sections (type: "article" in manifest) */
.article-main {
    max-width: 900px; /* Control the main article area width */
    width: 100%;
    min-width: 0 !important; /* Allow shrinking on small screens */
}

.article-section {
    max-width: 850px; /* Control individual article sections */
    width: 100%;
    min-width: 0 !important; /* Allow shrinking on small screens */
}

/* Grid children should shrink */
.article-sidebar {
    min-width: 0 !important;
}

/* Ensure embedded media never overflows */
.article-content img,
.article-content svg,
.article-content canvas,
.article-content video {
    max-width: 100%;
    height: auto;
}

/* Tables responsive */
.article-content table {
    display: block;
    overflow-x: auto;
}

/* Apply the same left start to ALL content wrappers (incl. callout dynamic) */
.hero-content,
.article-container,
.section-wide__content,
.section-content-container,
.section-callout__content,
.section-callout__content--full-width {
    padding-left: calc(var(--padding-container) + var(--content-left-bias)) !important;
}

/* Kill the old left shift so types line up */
.article-main {
    margin-left: 0 !important;
}

/* Keep container positioned normally */
.article-container {
    left: 0 !important;
}

/* Make sure the main column can actually shrink when the viewport narrows */
.article-container { 
    grid-template-columns: minmax(0, 1fr) 240px;
}

/* Ensure grid can shrink on wider screens too */
@media (min-width: 1280px) {
    .article-container {
        grid-template-columns: minmax(0, 1fr) 240px;
    }
}

/* Additional mobile adjustments */
@media (max-width: 768px) {
    .article-container {
        padding: 0 24px;
    }
    
    .section-callout__content {
        padding: 16px 24px;
    }
    
    .article-sidebar {
        width: 100%;
        min-width: 0;
    }
    
    .paper-info-card {
        min-width: 0;
    }
}
</style>
{% endblock %}

{% block content %}

<!-- Main content wrapper -->
<div class="main-content">

{% for section in manifest.sections %}
    {% if not (section.disabled or section.hidden) %}
    <div class="page-section">
    {# Handle hero section #}
    {% if section.type == 'hero' %}
        {% include project_path + '/' + section.file %}
    
    {# Handle section callouts #}
    {% elif section.type == 'section_callout' or section.type == 'section_callout_dynamic' %}
        <section class="section-callout section-callout--{{ manifest.page_config.color_theme }}">
            <div class="section-callout__content{% if section.full_width %} section-callout__content--full-width{% endif %}">
                {% if section.title or section.text %}
                <div class="section-callout__header">
                    {% if section.title %}<h3 class="section-callout__title">{{ section.title }}</h3>{% endif %}
                    {% if section.text %}<p class="section-callout__text">{{ section.text }}</p>{% endif %}
                </div>
                {% endif %}
                {% include project_path + '/' + section.file %}
            </div>
        </section>
    
    {# Handle article sections #}
    {% elif section.type == 'article' %}
        <div class="article-container">
            <div class="article-main">
                <article class="article-content">
                    {% if section.section_id %}<section id="{{ section.section_id }}" class="article-section">{% endif %}
                    {% if section.title %}<h1 class="main-section-title">{{ section.title }}</h1>{% endif %}
                    <div class="article-section-spacing">
                        {% include project_path + '/' + section.file %}
                    </div>
                    {% if section.section_id %}</section>{% endif %}
                </article>
            </div>
            {% if section.include_sidebar %}
            <aside class="article-sidebar">
                <!-- Paper Info Card -->
                <div class="paper-info-card">
                    <h3>Paper Info</h3>
                    <ul class="paper-info-list">
                        <li><strong>Title:</strong> {{ project.paper_title_display }}</li>
                        <li><strong>Author:</strong> {{ project.paper_authors_display | replace('by ', '') }}</li>
                        {% if project.doi %}
                        <li><strong>DOI:</strong> <a href="https://doi.org/{{ project.doi }}" target="_blank">{{ project.doi }}</a></li>
                        {% else %}
                        <li><strong>Status:</strong> Manuscript in preparation</li>
                        {% endif %}
                    </ul>
                </div>
            </aside>
            {% endif %}
        </div>
        
    {# Handle inline callouts #}
    {% elif section.type == 'callout_inline' %}
        <div class="article-container">
            <div class="callout callout-{{ section.callout_type }}{% if section.compact %} callout-compact{% endif %}">
                {% if section.header %}<div class="callout-header">{{ section.header }}</div>{% endif %}
                <div class="callout-content">
                    {% include project_path + '/' + section.file %}
                </div>
            </div>
        </div>
        
    {# Handle article content #}
    {% elif section.type == 'article_content' %}
        <div class="article-container">
            <div class="article-section-spacing">
                {% include project_path + '/' + section.file %}
            </div>
        </div>
        
    {# Handle section wide - full width standard sections #}
    {% elif section.type == 'section_wide' %}
        <section class="section-wide">
            <div class="section-wide__content{% if section.full_width %}--full-width{% endif %}">
                {% if section.title %}
                <h2 class="section-title" style="text-align: center; margin-bottom: var(--spacing-section);">{{ section.title }}</h2>
                {% endif %}
                {% include project_path + '/' + section.file %}
            </div>
        </section>
        
    {# Handle raw includes #}
    {% elif section.type == 'raw' %}
        {% if '../../components/' in section.file %}
            {% include 'components/' + section.file.split('../../components/')[1] %}
        {% else %}
            {% include project_path + '/' + section.file %}
        {% endif %}
    {% endif %}
    </div> <!-- Close page-section -->
    {% endif %}
{% endfor %}

</div> <!-- Close main-content -->

<!-- Footer -->
{% include 'partials/footer.html' %}


<!-- Export functionality -->
<script src="{{ url_for('static', filename='js/section_export.js') }}"></script>

<!-- Page-specific scripts -->
{% for section in manifest.sections %}
    {% if section.scripts %}
        {% for script in section.scripts %}
        <script src="{{ url_for('static', filename=script) }}"></script>
        {% endfor %}
    {% endif %}
{% endfor %}


{% endblock %}
