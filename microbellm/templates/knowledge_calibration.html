{% extends "base.html" %}

{% block title %}Hallucination Test - LLM-BioEval{% endblock %}

{% block extra_head %}
<style>
    /* Remove main content padding override - let layout.css handle it */

    /* Hero Header Section - Using layout system */
    .hero-header {
        /* Remove custom positioning, use layout.css defaults */
        position: relative;
        overflow: hidden;
    }

    /* Header animation canvas */
    .hero-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        opacity: 0.15;
        z-index: 1;
    }

    /* Color transition overlay */
    .hero-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.1) 0%,
            rgba(168, 85, 247, 0.08) 25%,
            rgba(59, 130, 246, 0.1) 50%,
            rgba(147, 51, 234, 0.08) 75%,
            rgba(79, 172, 254, 0.1) 100%);
        z-index: 2;
        animation: colorShift 15s ease-in-out infinite;
    }

    @keyframes colorShift {
        0%, 100% { 
            background: linear-gradient(135deg, 
                rgba(99, 102, 241, 0.1) 0%,
                rgba(168, 85, 247, 0.08) 25%,
                rgba(59, 130, 246, 0.1) 50%,
                rgba(147, 51, 234, 0.08) 75%,
                rgba(79, 172, 254, 0.1) 100%);
        }
        50% { 
            background: linear-gradient(135deg, 
                rgba(147, 51, 234, 0.12) 0%,
                rgba(79, 172, 254, 0.1) 25%,
                rgba(99, 102, 241, 0.08) 50%,
                rgba(168, 85, 247, 0.1) 75%,
                rgba(59, 130, 246, 0.12) 100%);
        }
    }

    /* Hero content uses layout system alignment */
    .hero-content {
        position: relative;
        z-index: 3;
        text-align: left;
        color: var(--gray-900);
    }

    .hero-title {
        font-size: 48px;
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 24px;
        letter-spacing: -0.02em;
        color: var(--gray-900);
    }

    .hero-author {
        font-size: 15px;
        color: #6366f1;
        font-weight: 500;
        margin-bottom: 10px;
        margin-top: -10px;
    }

    .hero-subtitle {
        font-size: 20px;
        font-weight: 400;
        line-height: 1.6;
        color: var(--gray-600);
        max-width: 700px;
        margin: 0;
    }

    /* Article layout already handled by layout.css */
    
    /* Background animation canvas */
    .background-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        pointer-events: none;
        opacity: 0.03;
        z-index: 0;
    }
    
    /* Article content */
    .article-section {
        margin-bottom: var(--spacing-section);
        scroll-margin-top: 100px;
    }
    
    .section-title {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 24px;
        color: var(--gray-900);
        letter-spacing: -0.01em;
    }
    
    .article-text {
        font-size: 18px;
        line-height: 1.7;
        color: var(--gray-700);
        margin-bottom: 24px;
    }
    
    .article-text p {
        margin-bottom: 20px;
    }

    /* Experimental Flow Diagram - Full width section */
    .experimental-flow-section {
        /* Use section-full from layout.css */
        width: 100vw;
        margin-left: calc(-50vw + 50%);
        padding: var(--spacing-section) 0;
        margin-top: var(--spacing-component);
        margin-bottom: var(--spacing-section);
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.05) 0%,
            rgba(168, 85, 247, 0.03) 25%,
            rgba(59, 130, 246, 0.05) 50%,
            rgba(147, 51, 234, 0.03) 75%,
            rgba(79, 172, 254, 0.05) 100%);
        border-top: 1px solid var(--gray-200);
        border-bottom: 1px solid var(--gray-200);
    }
    
    .flow-diagram-wrapper {
        max-width: var(--container-standard);
        margin: 0 auto;
        padding: 0 var(--padding-container);
    }

    @media (max-width: 768px) {
        .experimental-flow-section {
            padding: 40px 0;
        }
        .flow-diagram-wrapper {
            padding: 0 20px;
        }
    }
    
    .flow-diagram {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 20px;
        flex-wrap: wrap;
        margin-bottom: 24px;
    }
    
    /* correlation special layout */
    .corr-legacy { display: none !important; }
    .flow-result-box { background: var(--bg-primary); border: 1px solid var(--gray-200); border-radius: 12px; padding: 16px; min-width: 120px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.05);}    
    /* Grid for correlation demo */
    .flow-grid { display: grid; grid-template-columns: auto 60px auto 60px auto 60px auto; grid-template-rows: auto auto; align-items: center; gap: 20px; }
    .grid-species { grid-row: 1 / span 2; grid-column: 1; }
    .grid-correlation { grid-row: 1 / span 2; grid-column: 7; }
    
    /* Column wrapper to stack boxes */
    .flow-column {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .flow-box {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
        flex-shrink: 0;
    }
    
    .flow-box:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    /* Input Box */
    .flow-input {
        text-align: center;
        min-width: 240px;
    }
    
    .flow-species {
        font-size: 20px;
        font-style: italic;
        font-weight: 300;
        color: #7c3aed;
        margin-bottom: 8px;
    }
    
    .flow-label {
        font-size: 13px;
        color: var(--gray-600);
    }
    
    /* Query Box */
    .flow-query {
        min-width: 260px;
    }
    
    .query-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 16px;
        text-align: center;
    }
    
    .query-templates {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .query-template {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: var(--gray-600);
        padding: 4px 8px;
        border-radius: 6px;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .query-template:hover {
        background: var(--gray-50);
    }
    
    .query-template.active {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
    }
    
    .template-number {
        width: 28px;
        height: 20px;
        background: var(--gray-100);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 11px;
        color: var(--gray-700);
        transition: all 0.3s ease;
    }
    
    .query-template.active .template-number {
        background: var(--primary);
        color: white;
    }
    
    .template-type {
        font-size: 12px;
    }
    
    /* Output Box */
    .flow-output {
        min-width: 280px;
    }
    
    .output-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 16px;
        text-align: center;
    }
    
    .output-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 8px;
        justify-content: center;
        max-width: 400px;
        position: relative;
    }
    
    .output-option {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
        position: relative;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        border: 1px solid transparent;
        min-height: 32px;
        gap: 6px;
    }
    
    .output-option.good {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border-color: rgba(16, 185, 129, 0.2);
    }
    
    .output-option.caution {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border-color: rgba(245, 158, 11, 0.2);
    }
    
    .output-option.bad {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    .output-option.worst {
        background: rgba(127, 29, 29, 0.1);
        color: #991b1b;
        border-color: rgba(127, 29, 29, 0.2);
    }
    
    /* Expectation indicators */
    .expectation-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .expectation-indicator span {
        font-size: 14px;
        font-weight: 700;
        display: none;
        transition: all 0.3s ease;
        margin-left: 2px;
    }
    
    .expectation-indicator .expect-none {
        color: #dc2626;
    }
    
    .expectation-indicator .expect-q1,
    .expectation-indicator .expect-q2,
    .expectation-indicator .expect-q3 {
        color: #059669;
    }
    
    /* Show indicators during animation */
    .output-option.highlight .expectation-indicator span {
        display: inline-block !important;
        animation: checkmarkAppear 0.5s ease-out;
    }
    
    @keyframes checkmarkAppear {
        0% {
            transform: scale(0);
            opacity: 0;
        }
        50% {
            transform: scale(1.2);
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    /* Highlight animation */
    .output-option.highlight {
        animation: pulse 2s ease-in-out infinite;
        box-shadow: 0 0 0 3px currentColor, 0 6px 20px rgba(0, 0, 0, 0.15);
        font-weight: 700;
        transform: scale(1.03);
        border-color: currentColor !important;
    }
    
    @keyframes pulse {
        0%, 100% {
            opacity: 1;
            transform: scale(1.03);
        }
        50% {
            opacity: 0.9;
            transform: scale(1.05);
        }
    }
    
    /* Legend */
    .flow-legend {
        display: flex;
        justify-content: center;
        gap: 32px;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray-600);
    }
    
    .legend-symbol {
        font-weight: 600;
        color: var(--gray-700);
    }
    
    .legend-symbol.success {
        color: #10b981;
    }
    
    .legend-symbol.caution {
        color: #f59e0b;
    }
    
    /* Arrows */
    .flow-arrow {
        color: var(--gray-400);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    /* Responsive adjustments */
    @media (max-width: 1024px) {
        .flow-diagram {
            gap: 12px;
            padding: 10px 20px;
        }
        
        .flow-box {
            padding: 20px;
        }
        
        .flow-arrow svg {
            width: 40px;
        }
        
        .flow-legend {
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .output-options {
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 6px;
            max-width: 320px;
        }
        
        .output-option {
            padding: 8px 10px;
            font-size: 12px;
            min-height: 28px;
        }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .hero-header {
            padding: 60px 0 80px;
        }

        .hero-content {
            padding: 0 24px;
        }
        
        .hero-title {
            font-size: 40px;
        }
        
        .hero-subtitle {
            font-size: 18px;
        }
        
        .article-container {
            padding: 32px 16px;
        }
        
        .section-title {
            font-size: 24px;
        }
        
        .article-text {
            font-size: 16px;
        }
    }

    /* Species Animation Styles */
    .species-animation-container {
        text-align: center;
        padding: 16px 0 12px 0;
    }
    
    .callout .species-animation-container {
        margin: 0;
    }
    
    .callout-compact {
        padding: 16px 20px !important;
    }
    
    .species-animated {
        font-size: 24px;
        font-style: italic;
        font-weight: 300;
        letter-spacing: 0.02em;
        color: var(--gray-900);
        margin-bottom: 12px;
        min-height: 36px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
    }
    
    .genus-part, .species-part {
        position: relative;
        display: inline-block;
        transition: all 0.3s ease;
    }
    
    .species-part.fictional,
    .genus-part.fictional {
        color: #7c3aed;
    }
    
    .skeleton-word {
        display: inline-block;
        height: 24px;
        background: linear-gradient(90deg, 
            rgba(147, 51, 234, 0.1) 25%, 
            rgba(99, 102, 241, 0.15) 50%, 
            rgba(147, 51, 234, 0.1) 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: 4px;
        vertical-align: middle;
    }
    
    .animation-label {
        font-size: 13px;
        color: var(--gray-600);
        font-style: normal;
        transition: all 0.3s ease;
    }

    .artificial-part {
        text-decoration: underline;
        text-decoration-thickness: 2px;
        text-underline-offset: 2px;
        color: #7c3aed;
    }

    /* Callout boxes */
    .callout {
        position: relative;
        margin: 32px 0;
        margin-left: 120px;
        padding: 24px 28px;
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
        width: calc(100% - 120px + 75px);
        font-size: 13px;
        line-height: 1.5;
    }
    
    .callout-definition {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.08) 0%,
            rgba(168, 85, 247, 0.06) 25%,
            rgba(59, 130, 246, 0.08) 50%,
            rgba(147, 51, 234, 0.06) 75%,
            rgba(79, 172, 254, 0.08) 100%);
        border: 1px solid rgba(99, 102, 241, 0.2);
        backdrop-filter: blur(8px);
    }
    
    .callout-template {
        background: linear-gradient(135deg, 
            rgba(147, 51, 234, 0.08) 0%,
            rgba(79, 172, 254, 0.06) 25%,
            rgba(99, 102, 241, 0.08) 50%,
            rgba(168, 85, 247, 0.06) 75%,
            rgba(59, 130, 246, 0.08) 100%);
        border: 1px solid rgba(147, 51, 234, 0.2);
        backdrop-filter: blur(8px);
    }
    
    .callout-header {
        display: none;
    }
    
    .callout-content {
        font-size: 13px;
        line-height: 1.6;
        color: var(--gray-700);
        font-style: italic;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .callout-content strong {
        font-style: normal;
        font-weight: 600;
        color: var(--gray-900);
    }
    
    .callout-definition .callout-header {
        color: #6366f1;
        font-weight: 700;
    }
    
    .callout-template .callout-header {
        color: #9333ea;
        font-weight: 700;
    }
    
    /* Template showcase */
    .template-showcase {
        margin: 32px 0;
        padding: 24px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        position: relative;
        overflow: hidden;
    }
    
    .template-showcase.loading .template-code {
        position: relative;
    }
    
    .template-code {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 20px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.6;
        color: var(--gray-800);
        white-space: pre-wrap;
        margin-bottom: 16px;
        transition: all 0.3s ease;
    }
    
    /* Skeleton loading effect */
    .skeleton-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--bg-primary);
        z-index: 10;
        display: none;
        padding: 20px;
    }
    
    .template-showcase.loading .skeleton-overlay {
        display: block;
    }
    
    .skeleton-line {
        height: 14px;
        background: linear-gradient(90deg, 
            rgba(147, 51, 234, 0.08) 25%, 
            rgba(99, 102, 241, 0.12) 50%, 
            rgba(147, 51, 234, 0.08) 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        margin-bottom: 10px;
        border-radius: 4px;
    }
    
    .skeleton-line:nth-child(2) { width: 80%; }
    .skeleton-line:nth-child(3) { width: 90%; }
    .skeleton-line:nth-child(4) { width: 70%; }
    
    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }
    
    .template-highlight {
        background: rgba(245, 158, 11, 0.2);
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: 600;
        color: #d97706;
    }
    
    .template-caption {
        font-size: 14px;
        color: var(--gray-600);
        font-style: italic;
        text-align: center;
    }
    
    /* Data visualization section */
    .data-section {
        margin: 48px 0;
        padding: 48px 32px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
    }
    
    .template-content {
        display: block;
    }
    
    /* Legend */
    .legend-container {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 32px;
    }
    
    .legend-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 16px;
        color: var(--gray-900);
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .article-title {
            font-size: 36px;
        }
        
        .section-title {
            font-size: 24px;
        }
        
        .article-text {
            font-size: 16px;
        }

        .article-content {
            max-width: 100%;
        }

        .callout {
            float: none;
            margin: 24px 0;
            margin-right: 0;
            width: 100%;
            position: relative;
        }

        .callout::before {
            left: -8px;
        }
        
        #scoreExampleContainer {
            float: none !important;
            width: 100% !important;
            margin: 24px 0 !important;
        }
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .output-option.hide {
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: all 0.4s ease;
        filter: blur(2px);
    }

    .query-description {
        font-size: 13px;
        color: var(--gray-700);
        font-weight: 500;
        margin-bottom: 8px;
        line-height: 1.5;
        letter-spacing: 0.02em;
    }
    
    /* NEW: Animated flow result text */
    .flow-result {
        font-size: 18px;
        font-weight: 600;
        margin-top: 6px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* NEW: container for downward arrow + result */
    .flow-down {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 8px;
    }
    .down-arrow {
        color: var(--gray-400);
        margin-bottom: 4px;
    }

    /* Correlation Flow Grid Styles */
    .flow-grid {
        display: grid;
        grid-template-columns: auto 60px auto 60px auto 60px auto;
        grid-template-rows: auto auto;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
    }

    .grid-species { 
        grid-row: 1 / span 2; 
        grid-column: 1; 
    }
    
    .grid-correlation { 
        grid-row: 1 / span 2; 
        grid-column: 7; 
    }

    .flow-result-box {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 16px 24px;
        min-width: 120px;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        transition: all 0.3s ease;
    }

    .flow-result-box.highlight {
        animation: pulse 2s ease-in-out infinite;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3), 0 6px 20px rgba(0, 0, 0, 0.15);
        transform: scale(1.03);
    }

    /* Arrow styling for correlation flow */
    .flow-arrow svg {
        color: var(--gray-400);
        transition: all 0.3s ease;
    }

    .flow-arrow.active svg {
        color: var(--primary);
        filter: drop-shadow(0 2px 4px rgba(99, 102, 241, 0.3));
    }

    .output-description {
        font-size: 11px;
        color: var(--gray-500);
        font-weight: 400;
        margin-bottom: 8px;
        line-height: 1.4;
        letter-spacing: 0.01em;
    }

    /* Loading and empty states */
    .loading-container {
        text-align: center;
        padding: 40px 20px;
    }
    
    .loading-progress {
        width: 200px;
        height: 4px;
        background: var(--gray-200);
        border-radius: 2px;
        margin: 0 auto 16px;
        overflow: hidden;
    }
    
    .loading-progress-bar {
        width: 30%;
        height: 100%;
        background: var(--primary, #6366f1);
        animation: loading-move 2s infinite;
    }
    
    @keyframes loading-move {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(400%); }
    }
    
    .loading-text {
        color: var(--gray-600);
        font-size: 14px;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-600);
    }
    
    .empty-state h3 {
        color: var(--gray-900);
        margin-bottom: 8px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
        font-size: 14px;
    }
    
    .knowledge-analysis-table th,
    .knowledge-analysis-table td {
        padding: 8px 12px;
        border: 1px solid var(--gray-200);
        text-align: left;
    }
    
    .knowledge-analysis-table th {
        background: var(--gray-50);
        font-weight: 600;
    }
    
    /* Model name cell styling */
    .model-name-cell {
        background-color: var(--gray-50);
        font-weight: 600;
        color: var(--gray-700);
        text-align: left;
        padding-left: 10px;
        font-size: 11px;
        white-space: nowrap;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .chart-cell {
        padding: 4px 8px;
    }
    
    .no-data {
        text-align: center;
        color: var(--gray-500);
        font-style: italic;
        font-size: 11px;
    }
    
    /* Analysis stats cards */
    .analysis-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow-sm);
    }
    
    .stat-card.positive {
        border-color: #28a745;
        background-color: #f8fff9;
    }
    
    .stat-card.negative {
        border-color: #dc3545;
        background-color: #fff8f8;
    }
    
    .stat-card.neutral {
        border-color: var(--gray-400);
        background-color: var(--gray-50);
    }
    
    .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 14px;
        color: var(--gray-600);
        font-weight: 500;
    }
    
    .model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
    }
    
    /* Template header styles */
    .template-header-with-description {
        margin-bottom: 15px;
    }
    
    .template-header-link {
        color: var(--gray-900);
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .template-header-link:hover {
        color: var(--primary);
        text-decoration: underline;
    }
    
    .template-description-text {
        margin: 0;
        color: var(--gray-600);
        font-size: 13px;
        font-style: italic;
        line-height: 1.4;
    }
    
    /* Knowledge Analysis Container */
    .knowledge-analysis-container {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    /* Dynamic Stats Text */
    .dynamic-stats {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.05) 0%,
            rgba(168, 85, 247, 0.03) 50%,
            rgba(59, 130, 246, 0.05) 100%);
        border: 1px solid rgba(99, 102, 241, 0.1);
        border-radius: 12px;
        padding: 20px 28px;
        margin-bottom: 48px;
        font-size: 16px;
        line-height: 1.8;
        color: var(--gray-700);
    }
    
    /* Winner showcase */
    .winner-showcase {
        background: linear-gradient(135deg, 
            rgba(16, 185, 129, 0.05) 0%,
            rgba(34, 197, 94, 0.03) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 12px;
        padding: 24px;
        margin: 32px 0;
    }
    
    .winner-showcase h4 {
        color: var(--gray-900);
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 16px 0;
    }
    
    .winner-example {
        display: flex;
        align-items: center;
        gap: 24px;
        margin-bottom: 16px;
    }
    
    .winner-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        font-size: 14px;
        color: var(--gray-900);
        min-width: 120px;
    }
    
    .winner-category {
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        min-width: 180px;
    }
    
    .winner-bar-chart {
        flex: 1;
        max-width: 400px;
    }
    
    .winner-description {
        font-size: 14px;
        color: var(--gray-600);
        line-height: 1.6;
        margin-top: 12px;
    }
    
    /* Expandable table */
    .table-controls {
        display: flex;
        justify-content: center;
        margin-top: 16px;
        margin-bottom: -1px;
    }
    
    .expand-button {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 8px 20px;
        font-size: 13px;
        font-weight: 500;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .expand-button:hover {
        background: var(--gray-50);
        color: var(--gray-900);
    }
    
    .expand-icon {
        width: 16px;
        height: 16px;
        transition: transform 0.3s ease;
    }
    
    .expand-button.expanded .expand-icon {
        transform: rotate(180deg);
    }
    
    .knowledge-analysis-table tbody tr.hidden-row {
        display: none;
    }
    
    .knowledge-analysis-table tbody tr.hidden-row.show {
        display: table-row;
    }
    
    .table-fade {
        position: relative;
    }
    
    .table-fade::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.9));
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .table-fade.expanded::after {
        opacity: 0;
    }
    
    .stat-value {
        display: inline-block;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(99, 102, 241, 0.1);
        border-radius: 6px;
        margin: 0 2px;
        padding: 2px 6px;
        font-size: inherit;
    }
    
    .model-highlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(124, 58, 237, 0.1);
        color: #7c3aed;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    .model-lowlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    /* Remove container styling from knowledge tables */
    .knowledge-analysis-table-wrapper {
        margin-bottom: 48px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
        background: var(--bg-primary);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .knowledge-analysis-table th {
        background: linear-gradient(to bottom, #f8f9fa, #f1f3f5);
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        border-bottom: 1px solid var(--gray-200);
    }
    
    .knowledge-analysis-table td {
        padding: 12px 20px;
        border-bottom: 1px solid var(--gray-100);
        vertical-align: middle;
    }
    
    .knowledge-analysis-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .knowledge-analysis-table tbody tr:hover {
        background: rgba(99, 102, 241, 0.02);
    }
    
    /* Template header without box */
    .template-section-header {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
    }
    
    .template-section-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0 0 8px 0;
    }
    
    .template-section-description {
        font-size: 14px;
        color: var(--gray-600);
        font-style: italic;
        margin: 0;
    }
    
    /* Enhanced bar chart styles */
    .bar-chart-container {
        width: 100%;
        height: 24px;
        background: var(--gray-100);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }
    
    .bar-chart-segments {
        display: flex;
        height: 100%;
        width: 100%;
    }
    
    .bar-segment {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        position: relative;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .bar-segment:hover {
        filter: brightness(1.1);
        z-index: 10;
    }
    
    .bar-segment.knowledge-limited {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
    }
    
    .bar-segment.knowledge-moderate {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        color: #0c5460;
    }
    
    .bar-segment.knowledge-extensive {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
    }
    
    .bar-segment.knowledge-na {
        background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
        color: #383d41;
    }
    
    .bar-segment.knowledge-no-result,
    .bar-segment.knowledge-failed {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
    }
    
    .bar-number {
        font-size: 12px;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    .bar-segment:hover .bar-number,
    .bar-segment.show-number .bar-number {
        opacity: 1;
    }
    
    /* Quality score styling */
    .quality-score-cell {
        text-align: center;
        font-weight: 700;
        font-size: 14px;
    }
    
    .quality-score-value {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.1) 0%,
            rgba(168, 85, 247, 0.08) 100%);
        color: var(--primary);
        cursor: help;
        transition: all 0.2s ease;
    }
    
    .quality-score-value:hover {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.2) 0%,
            rgba(168, 85, 247, 0.15) 100%);
        transform: scale(1.05);
    }
    
    /* Compact Score Example */
    .score-example-compact {
        background: linear-gradient(135deg, 
            rgba(147, 51, 234, 0.05) 0%,
            rgba(99, 102, 241, 0.03) 100%);
        border: 1px solid rgba(147, 51, 234, 0.15);
        border-radius: 12px;
        padding: 20px;
        margin: 32px 0;
        font-size: 13px;
    }
    
    .score-example-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(147, 51, 234, 0.1);
    }
    
    .score-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .score-template-name {
        font-size: 12px;
        color: var(--gray-600);
        background: var(--gray-100);
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 500;
    }
    
    .score-breakdown-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
    }
    
    .score-type-breakdown {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
    }
    
    .score-type-title {
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 8px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .score-items {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 8px;
    }
    
    .score-item {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 11px;
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 4px;
        border: 1px solid transparent;
    }
    
    .score-item.good {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border-color: rgba(16, 185, 129, 0.2);
    }
    
    .score-item.caution {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border-color: rgba(245, 158, 11, 0.2);
    }
    
    .score-item.bad {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    .score-item.worst {
        background: rgba(127, 29, 29, 0.1);
        color: #991b1b;
        border-color: rgba(127, 29, 29, 0.2);
    }
    
    .score-subtotal {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 12px;
        text-align: right;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .score-final {
        background: var(--bg-primary);
        border: 2px solid rgba(147, 51, 234, 0.2);
        border-radius: 8px;
        padding: 12px 16px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }
    
    .score-calculation {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        color: var(--gray-700);
        font-weight: 500;
    }
    
    .score-result {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 6px 12px;
        border-radius: 6px;
    }
    
    @media (max-width: 768px) {
        .score-breakdown-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .score-example-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .score-final {
            flex-direction: column;
            gap: 8px;
        }
    }

    /* Correlation Tooltip and Scatter Plot Styles */
    .correlation-tooltip {
        position: fixed;
        z-index: 1000;
        pointer-events: none;
        filter: drop-shadow(0 2px 12px rgba(0,0,0,0.15));
    }
    .correlation-tooltip-content {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 12px;
        width: 280px;
    }
    .correlation-tooltip-header {
        font-weight: 700;
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e9ecef;
        color: #2c3e50;
        font-size: 12px;
    }
    .scatter-plot-container {
        width: 256px;
        height: 180px;
        position: relative;
        margin: 8px 0;
    }
    .scatter-plot-canvas {
        width: 256px;
        height: 180px;
    }

    .experimental-flow-section {
        margin-top: 12px !important;
        margin-bottom: 48px;
        padding-top: 32px !important;
        padding-bottom: 60px;
    }
    .article-container > .article-main > article > p:last-of-type {
        margin-bottom: 10px !important;
    }

    .performer-score strong {
        font-weight: 700;
        color: var(--gray-900);
    }

    .worst-performer-section {
        margin: 32px 0;
    }
    .performer-card.worst {
        background: linear-gradient(135deg, #fff1f2, #ffe4e6);
        border-color: #fecaca;
    }
    .performer-card.worst .performer-rank {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
    }

    .histogram-section {
        margin: 48px 0;
        padding: 24px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
    }
    .histogram-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    .histogram-description {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 24px;
    }
    .histogram-chart {
        display: flex;
        align-items: flex-end;
        gap: 2px;
        height: 120px;
        border-bottom: 2px solid var(--gray-300);
        padding-bottom: 4px;
    }
    .histogram-bin {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        text-align: center;
    }
    .histogram-bar {
        width: 90%;
        background: linear-gradient(to top, var(--primary), #a78bfa);
        border-radius: 4px 4px 0 0;
        color: white;
        font-size: 12px;
        font-weight: 600;
        line-height: 1.5;
        padding-top: 4px;
        transition: all 0.2s ease;
        position: relative;
    }
    .histogram-bar.bad { background: linear-gradient(to top, #ef4444, #f87171); }
    .histogram-bar.moderate { background: linear-gradient(to top, #f59e0b, #fcd34d); }
    .histogram-bar.good { background: linear-gradient(to top, #22c55e, #86efac); }
    .histogram-bar:hover {
        filter: brightness(1.1);
    }
    .histogram-label {
        margin-top: 8px;
        font-size: 12px;
        color: var(--gray-600);
    }
    .histogram-legend {
        display: flex;
        justify-content: center;
        gap: 24px;
        margin-top: 16px;
    }
    .histogram-legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray-600);
    }
    .histogram-legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .performers-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        margin-top: 16px;
    }
    .performer-card {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
        padding: 16px;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .performer-rank {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-700);
        background: rgba(16, 185, 129, 0.1);
        border-radius: 4px;
        padding: 4px 8px;
        margin-bottom: 8px;
    }
    .performer-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 4px;
    }
    .performer-score {
        font-size: 14px;
        color: var(--gray-700);
        margin-bottom: 8px;
    }
    .performer-dist-chart {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .performer-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .output-option.hide {
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: all 0.4s ease;
        filter: blur(2px);
    }

    .query-description {
        font-size: 13px;
        color: var(--gray-700);
        font-weight: 500;
        margin-bottom: 8px;
        line-height: 1.5;
        letter-spacing: 0.02em;
    }

    .output-description {
        font-size: 11px;
        color: var(--gray-500);
        font-weight: 400;
        margin-bottom: 8px;
        line-height: 1.4;
        letter-spacing: 0.01em;
    }

    /* Loading and empty states */
    .loading-container {
        text-align: center;
        padding: 40px 20px;
    }
    
    .loading-progress {
        width: 200px;
        height: 4px;
        background: var(--gray-200);
        border-radius: 2px;
        margin: 0 auto 16px;
        overflow: hidden;
    }
    
    .loading-progress-bar {
        width: 30%;
        height: 100%;
        background: var(--primary, #6366f1);
        animation: loading-move 2s infinite;
    }
    
    @keyframes loading-move {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(400%); }
    }
    
    .loading-text {
        color: var(--gray-600);
        font-size: 14px;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-600);
    }
    
    .empty-state h3 {
        color: var(--gray-900);
        margin-bottom: 8px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
        font-size: 14px;
    }
    
    .knowledge-analysis-table th,
    .knowledge-analysis-table td {
        padding: 8px 12px;
        border: 1px solid var(--gray-200);
        text-align: left;
    }
    
    .knowledge-analysis-table th {
        background: var(--gray-50);
        font-weight: 600;
    }
    
    /* Model name cell styling */
    .model-name-cell {
        background-color: var(--gray-50);
        font-weight: 600;
        color: var(--gray-700);
        text-align: left;
        padding-left: 10px;
        font-size: 11px;
        white-space: nowrap;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .chart-cell {
        padding: 4px 8px;
    }
    
    .no-data {
        text-align: center;
        color: var(--gray-500);
        font-style: italic;
        font-size: 11px;
    }
    
    /* Analysis stats cards */
    .analysis-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow-sm);
    }
    
    .stat-card.positive {
        border-color: #28a745;
        background-color: #f8fff9;
    }
    
    .stat-card.negative {
        border-color: #dc3545;
        background-color: #fff8f8;
    }
    
    .stat-card.neutral {
        border-color: var(--gray-400);
        background-color: var(--gray-50);
    }
    
    .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 14px;
        color: var(--gray-600);
        font-weight: 500;
    }
    
    .model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
    }
    
    /* Template header styles */
    .template-header-with-description {
        margin-bottom: 15px;
    }
    
    .template-header-link {
        color: var(--gray-900);
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .template-header-link:hover {
        color: var(--primary);
        text-decoration: underline;
    }
    
    .template-description-text {
        margin: 0;
        color: var(--gray-600);
        font-size: 13px;
        font-style: italic;
        line-height: 1.4;
    }
    
    /* Knowledge Analysis Container */
    .knowledge-analysis-container {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    /* Dynamic Stats Text */
    .dynamic-stats {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.05) 0%,
            rgba(168, 85, 247, 0.03) 50%,
            rgba(59, 130, 246, 0.05) 100%);
        border: 1px solid rgba(99, 102, 241, 0.1);
        border-radius: 12px;
        padding: 20px 28px;
        margin-bottom: 48px;
        font-size: 16px;
        line-height: 1.8;
        color: var(--gray-700);
    }
    
    /* Winner showcase */
    .winner-showcase {
        background: linear-gradient(135deg, 
            rgba(16, 185, 129, 0.05) 0%,
            rgba(34, 197, 94, 0.03) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 12px;
        padding: 24px;
        margin: 32px 0;
    }
    
    .winner-showcase h4 {
        color: var(--gray-900);
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 16px 0;
    }
    
    .winner-example {
        display: flex;
        align-items: center;
        gap: 24px;
        margin-bottom: 16px;
    }
    
    .winner-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        font-size: 14px;
        color: var(--gray-900);
        min-width: 120px;
    }
    
    .winner-category {
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        min-width: 180px;
    }
    
    .winner-bar-chart {
        flex: 1;
        max-width: 400px;
    }
    
    .winner-description {
        font-size: 14px;
        color: var(--gray-600);
        line-height: 1.6;
        margin-top: 12px;
    }
    
    /* Expandable table */
    .table-controls {
        display: flex;
        justify-content: center;
        margin-top: 16px;
        margin-bottom: -1px;
    }
    
    .expand-button {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 8px 20px;
        font-size: 13px;
        font-weight: 500;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .expand-button:hover {
        background: var(--gray-50);
        color: var(--gray-900);
    }
    
    .expand-icon {
        width: 16px;
        height: 16px;
        transition: transform 0.3s ease;
    }
    
    .expand-button.expanded .expand-icon {
        transform: rotate(180deg);
    }
    
    .knowledge-analysis-table tbody tr.hidden-row {
        display: none;
    }
    
    .knowledge-analysis-table tbody tr.hidden-row.show {
        display: table-row;
    }
    
    .table-fade {
        position: relative;
    }
    
    .table-fade::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.9));
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .table-fade.expanded::after {
        opacity: 0;
    }
    
    .stat-value {
        display: inline-block;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(99, 102, 241, 0.1);
        border-radius: 6px;
        margin: 0 2px;
        padding: 2px 6px;
        font-size: inherit;
    }
    
    .model-highlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(124, 58, 237, 0.1);
        color: #7c3aed;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    .model-lowlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    /* Remove container styling from knowledge tables */
    .knowledge-analysis-table-wrapper {
        margin-bottom: 48px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
        background: var(--bg-primary);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .knowledge-analysis-table th {
        background: linear-gradient(to bottom, #f8f9fa, #f1f3f5);
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        border-bottom: 1px solid var(--gray-200);
    }
    
    .knowledge-analysis-table td {
        padding: 12px 20px;
        border-bottom: 1px solid var(--gray-100);
        vertical-align: middle;
    }
    
    .knowledge-analysis-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .knowledge-analysis-table tbody tr:hover {
        background: rgba(99, 102, 241, 0.02);
    }
    
    /* Template header without box */
    .template-section-header {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
    }
    
    .template-section-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0 0 8px 0;
    }
    
    .template-section-description {
        font-size: 14px;
        color: var(--gray-600);
        font-style: italic;
        margin: 0;
    }
    
    /* Enhanced bar chart styles */
    .bar-chart-container {
        width: 100%;
        height: 24px;
        background: var(--gray-100);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }
    
    .bar-chart-segments {
        display: flex;
        height: 100%;
        width: 100%;
    }
    
    .bar-segment {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        position: relative;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .bar-segment:hover {
        filter: brightness(1.1);
        z-index: 10;
    }
    
    .bar-segment.knowledge-limited {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
    }
    
    .bar-segment.knowledge-moderate {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        color: #0c5460;
    }
    
    .bar-segment.knowledge-extensive {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
    }
    
    .bar-segment.knowledge-na {
        background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
        color: #383d41;
    }
    
    .bar-segment.knowledge-no-result,
    .bar-segment.knowledge-failed {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
    }
    
    .bar-number {
        font-size: 12px;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    .bar-segment:hover .bar-number,
    .bar-segment.show-number .bar-number {
        opacity: 1;
    }
    
    /* Quality score styling */
    .quality-score-cell {
        text-align: center;
        font-weight: 700;
        font-size: 14px;
    }
    
    .quality-score-value {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.1) 0%,
            rgba(168, 85, 247, 0.08) 100%);
        color: var(--primary);
        cursor: help;
        transition: all 0.2s ease;
    }
    
    .quality-score-value:hover {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.2) 0%,
            rgba(168, 85, 247, 0.15) 100%);
        transform: scale(1.05);
    }
    
    /* Compact Score Example */
    .score-example-compact {
        background: linear-gradient(135deg, 
            rgba(147, 51, 234, 0.05) 0%,
            rgba(99, 102, 241, 0.03) 100%);
        border: 1px solid rgba(147, 51, 234, 0.15);
        border-radius: 12px;
        padding: 20px;
        margin: 32px 0;
        font-size: 13px;
    }
    
    .score-example-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(147, 51, 234, 0.1);
    }
    
    .score-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .score-template-name {
        font-size: 12px;
        color: var(--gray-600);
        background: var(--gray-100);
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 500;
    }
    
    .score-breakdown-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
    }
    
    .score-type-breakdown {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
    }
    
    .score-type-title {
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 8px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .score-items {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 8px;
    }
    
    .score-item {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 11px;
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 4px;
        border: 1px solid transparent;
    }
    
    .score-item.good {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border-color: rgba(16, 185, 129, 0.2);
    }
    
    .score-item.caution {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border-color: rgba(245, 158, 11, 0.2);
    }
    
    .score-item.bad {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    .score-item.worst {
        background: rgba(127, 29, 29, 0.1);
        color: #991b1b;
        border-color: rgba(127, 29, 29, 0.2);
    }
    
    .score-subtotal {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 12px;
        text-align: right;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .score-final {
        background: var(--bg-primary);
        border: 2px solid rgba(147, 51, 234, 0.2);
        border-radius: 8px;
        padding: 12px 16px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }
    
    .score-calculation {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        color: var(--gray-700);
        font-weight: 500;
    }
    
    .score-result {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 6px 12px;
        border-radius: 6px;
    }
    
    @media (max-width: 768px) {
        .score-breakdown-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .score-example-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .score-final {
            flex-direction: column;
            gap: 8px;
        }
    }

    .experimental-flow-section {
        margin-top: 12px !important;
        margin-bottom: 48px;
        padding-top: 32px !important;
        padding-bottom: 60px;
    }
    .article-container > .article-main > article > p:last-of-type {
        margin-bottom: 10px !important;
    }

    .performer-score strong {
        font-weight: 700;
        color: var(--gray-900);
    }

    .worst-performer-section {
        margin: 32px 0;
    }
    .performer-card.worst {
        background: linear-gradient(135deg, #fff1f2, #ffe4e6);
        border-color: #fecaca;
    }
    .performer-card.worst .performer-rank {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
    }

    .histogram-section {
        margin: 48px 0;
        padding: 24px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
    }
    .histogram-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    .histogram-description {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 24px;
    }
    .histogram-chart {
        display: flex;
        align-items: flex-end;
        gap: 2px;
        height: 120px;
        border-bottom: 2px solid var(--gray-300);
        padding-bottom: 4px;
    }
    .histogram-bin {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        text-align: center;
    }
    .histogram-bar {
        width: 90%;
        background: linear-gradient(to top, var(--primary), #a78bfa);
        border-radius: 4px 4px 0 0;
        color: white;
        font-size: 12px;
        font-weight: 600;
        line-height: 1.5;
        padding-top: 4px;
        transition: all 0.2s ease;
        position: relative;
    }
    .histogram-bar.bad { background: linear-gradient(to top, #ef4444, #f87171); }
    .histogram-bar.moderate { background: linear-gradient(to top, #f59e0b, #fcd34d); }
    .histogram-bar.good { background: linear-gradient(to top, #22c55e, #86efac); }
    .histogram-bar:hover {
        filter: brightness(1.1);
    }
    .histogram-label {
        margin-top: 8px;
        font-size: 12px;
        color: var(--gray-600);
    }
    .histogram-legend {
        display: flex;
        justify-content: center;
        gap: 24px;
        margin-top: 16px;
    }
    .histogram-legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray-600);
    }
    .histogram-legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .performers-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        margin-top: 16px;
    }
    .performer-card {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
        padding: 16px;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .performer-rank {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-700);
        background: rgba(16, 185, 129, 0.1);
        border-radius: 4px;
        padding: 4px 8px;
        margin-bottom: 8px;
    }
    .performer-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 4px;
    }
    .performer-score {
        font-size: 14px;
        color: var(--gray-700);
        margin-bottom: 8px;
    }
    .performer-dist-chart {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .performer-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .output-option.hide {
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: all 0.4s ease;
        filter: blur(2px);
    }

    .query-description {
        font-size: 13px;
        color: var(--gray-700);
        font-weight: 500;
        margin-bottom: 8px;
        line-height: 1.5;
        letter-spacing: 0.02em;
    }

    .output-description {
        font-size: 11px;
        color: var(--gray-500);
        font-weight: 400;
        margin-bottom: 8px;
        line-height: 1.4;
        letter-spacing: 0.01em;
    }

    /* Loading and empty states */
    .loading-container {
        text-align: center;
        padding: 40px 20px;
    }
    
    .loading-progress {
        width: 200px;
        height: 4px;
        background: var(--gray-200);
        border-radius: 2px;
        margin: 0 auto 16px;
        overflow: hidden;
    }
    
    .loading-progress-bar {
        width: 30%;
        height: 100%;
        background: var(--primary, #6366f1);
        animation: loading-move 2s infinite;
    }
    
    @keyframes loading-move {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(400%); }
    }
    
    .loading-text {
        color: var(--gray-600);
        font-size: 14px;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-600);
    }
    
    .empty-state h3 {
        color: var(--gray-900);
        margin-bottom: 8px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
        font-size: 14px;
    }
    
    .knowledge-analysis-table th,
    .knowledge-analysis-table td {
        padding: 8px 12px;
        border: 1px solid var(--gray-200);
        text-align: left;
    }
    
    .knowledge-analysis-table th {
        background: var(--gray-50);
        font-weight: 600;
    }
    
    /* Model name cell styling */
    .model-name-cell {
        background-color: var(--gray-50);
        font-weight: 600;
        color: var(--gray-700);
        text-align: left;
        padding-left: 10px;
        font-size: 11px;
        white-space: nowrap;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .chart-cell {
        padding: 4px 8px;
    }
    
    .no-data {
        text-align: center;
        color: var(--gray-500);
        font-style: italic;
        font-size: 11px;
    }
    
    /* Analysis stats cards */
    .analysis-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow-sm);
    }
    
    .stat-card.positive {
        border-color: #28a745;
        background-color: #f8fff9;
    }
    
    .stat-card.negative {
        border-color: #dc3545;
        background-color: #fff8f8;
    }
    
    .stat-card.neutral {
        border-color: var(--gray-400);
        background-color: var(--gray-50);
    }
    
    .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 14px;
        color: var(--gray-600);
        font-weight: 500;
    }
    
    .model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
    }
    
    /* Template header styles */
    .template-header-with-description {
        margin-bottom: 15px;
    }
    
    .template-header-link {
        color: var(--gray-900);
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .template-header-link:hover {
        color: var(--primary);
        text-decoration: underline;
    }
    
    .template-description-text {
        margin: 0;
        color: var(--gray-600);
        font-size: 13px;
        font-style: italic;
        line-height: 1.4;
    }
    
    /* Knowledge Analysis Container */
    .knowledge-analysis-container {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    /* Dynamic Stats Text */
    .dynamic-stats {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.05) 0%,
            rgba(168, 85, 247, 0.03) 50%,
            rgba(59, 130, 246, 0.05) 100%);
        border: 1px solid rgba(99, 102, 241, 0.1);
        border-radius: 12px;
        padding: 20px 28px;
        margin-bottom: 48px;
        font-size: 16px;
        line-height: 1.8;
        color: var(--gray-700);
    }
    
    /* Winner showcase */
    .winner-showcase {
        background: linear-gradient(135deg, 
            rgba(16, 185, 129, 0.05) 0%,
            rgba(34, 197, 94, 0.03) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 12px;
        padding: 24px;
        margin: 32px 0;
    }
    
    .winner-showcase h4 {
        color: var(--gray-900);
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 16px 0;
    }
    
    .winner-example {
        display: flex;
        align-items: center;
        gap: 24px;
        margin-bottom: 16px;
    }
    
    .winner-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        font-size: 14px;
        color: var(--gray-900);
        min-width: 120px;
    }
    
    .winner-category {
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        min-width: 180px;
    }
    
    .winner-bar-chart {
        flex: 1;
        max-width: 400px;
    }
    
    .winner-description {
        font-size: 14px;
        color: var(--gray-600);
        line-height: 1.6;
        margin-top: 12px;
    }
    
    /* Expandable table */
    .table-controls {
        display: flex;
        justify-content: center;
        margin-top: 16px;
        margin-bottom: -1px;
    }
    
    .expand-button {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 8px 20px;
        font-size: 13px;
        font-weight: 500;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .expand-button:hover {
        background: var(--gray-50);
        color: var(--gray-900);
    }
    
    .expand-icon {
        width: 16px;
        height: 16px;
        transition: transform 0.3s ease;
    }
    
    .expand-button.expanded .expand-icon {
        transform: rotate(180deg);
    }
    
    .knowledge-analysis-table tbody tr.hidden-row {
        display: none;
    }
    
    .knowledge-analysis-table tbody tr.hidden-row.show {
        display: table-row;
    }
    
    .table-fade {
        position: relative;
    }
    
    .table-fade::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.9));
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .table-fade.expanded::after {
        opacity: 0;
    }
    
    .stat-value {
        display: inline-block;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(99, 102, 241, 0.1);
        border-radius: 6px;
        margin: 0 2px;
        padding: 2px 6px;
        font-size: inherit;
    }
    
    .model-highlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(124, 58, 237, 0.1);
        color: #7c3aed;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    .model-lowlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    /* Remove container styling from knowledge tables */
    .knowledge-analysis-table-wrapper {
        margin-bottom: 48px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
        background: var(--bg-primary);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .knowledge-analysis-table th {
        background: linear-gradient(to bottom, #f8f9fa, #f1f3f5);
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        border-bottom: 1px solid var(--gray-200);
    }
    
    .knowledge-analysis-table td {
        padding: 12px 20px;
        border-bottom: 1px solid var(--gray-100);
        vertical-align: middle;
    }
    
    .knowledge-analysis-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .knowledge-analysis-table tbody tr:hover {
        background: rgba(99, 102, 241, 0.02);
    }
    
    /* Template header without box */
    .template-section-header {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
    }
    
    .template-section-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0 0 8px 0;
    }
    
    .template-section-description {
        font-size: 14px;
        color: var(--gray-600);
        font-style: italic;
        margin: 0;
    }
    
    /* Enhanced bar chart styles */
    .bar-chart-container {
        width: 100%;
        height: 24px;
        background: var(--gray-100);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }
    
    .bar-chart-segments {
        display: flex;
        height: 100%;
        width: 100%;
    }
    
    .bar-segment {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        position: relative;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .bar-segment:hover {
        filter: brightness(1.1);
        z-index: 10;
    }
    
    .bar-segment.knowledge-limited {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
    }
    
    .bar-segment.knowledge-moderate {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        color: #0c5460;
    }
    
    .bar-segment.knowledge-extensive {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
    }
    
    .bar-segment.knowledge-na {
        background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
        color: #383d41;
    }
    
    .bar-segment.knowledge-no-result,
    .bar-segment.knowledge-failed {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
    }
    
    .bar-number {
        font-size: 12px;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    .bar-segment:hover .bar-number,
    .bar-segment.show-number .bar-number {
        opacity: 1;
    }
    
    /* Quality score styling */
    .quality-score-cell {
        text-align: center;
        font-weight: 700;
        font-size: 14px;
    }
    
    .quality-score-value {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.1) 0%,
            rgba(168, 85, 247, 0.08) 100%);
        color: var(--primary);
        cursor: help;
        transition: all 0.2s ease;
    }
    
    .quality-score-value:hover {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.2) 0%,
            rgba(168, 85, 247, 0.15) 100%);
        transform: scale(1.05);
    }
    
    /* Compact Score Example */
    .score-example-compact {
        background: linear-gradient(135deg, 
            rgba(147, 51, 234, 0.05) 0%,
            rgba(99, 102, 241, 0.03) 100%);
        border: 1px solid rgba(147, 51, 234, 0.15);
        border-radius: 12px;
        padding: 20px;
        margin: 32px 0;
        font-size: 13px;
    }
    
    .score-example-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(147, 51, 234, 0.1);
    }
    
    .score-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .score-template-name {
        font-size: 12px;
        color: var(--gray-600);
        background: var(--gray-100);
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 500;
    }
    
    .score-breakdown-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
    }
    
    .score-type-breakdown {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
    }
    
    .score-type-title {
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 8px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .score-items {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 8px;
    }
    
    .score-item {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 11px;
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 4px;
        border: 1px solid transparent;
    }
    
    .score-item.good {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border-color: rgba(16, 185, 129, 0.2);
    }
    
    .score-item.caution {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border-color: rgba(245, 158, 11, 0.2);
    }
    
    .score-item.bad {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    .score-item.worst {
        background: rgba(127, 29, 29, 0.1);
        color: #991b1b;
        border-color: rgba(127, 29, 29, 0.2);
    }
    
    .score-subtotal {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 12px;
        text-align: right;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .score-final {
        background: var(--bg-primary);
        border: 2px solid rgba(147, 51, 234, 0.2);
        border-radius: 8px;
        padding: 12px 16px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }
    
    .score-calculation {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        color: var(--gray-700);
        font-weight: 500;
    }
    
    .score-result {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 6px 12px;
        border-radius: 6px;
    }
    
    @media (max-width: 768px) {
        .score-breakdown-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .score-example-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .score-final {
            flex-direction: column;
            gap: 8px;
        }
    }

    .experimental-flow-section {
        margin-top: 12px !important;
        margin-bottom: 48px;
        padding-top: 32px !important;
        padding-bottom: 60px;
    }
    .article-container > .article-main > article > p:last-of-type {
        margin-bottom: 10px !important;
    }

    .performer-score strong {
        font-weight: 700;
        color: var(--gray-900);
    }

    .worst-performer-section {
        margin: 32px 0;
    }
    .performer-card.worst .performer-rank {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
    }

    .histogram-section {
        margin: 48px 0;
        padding: 24px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
    }
    .histogram-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    .histogram-description {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 24px;
    }
    .histogram-chart {
        display: flex;
        align-items: flex-end;
        gap: 2px;
        height: 120px;
        border-bottom: 2px solid var(--gray-300);
        padding-bottom: 4px;
    }
    .histogram-bin {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        text-align: center;
    }
    .histogram-bar {
        width: 90%;
        background: linear-gradient(to top, var(--primary), #a78bfa);
        border-radius: 4px 4px 0 0;
        color: white;
        font-size: 12px;
        font-weight: 600;
        line-height: 1.5;
        padding-top: 4px;
        transition: all 0.2s ease;
        position: relative;
    }
    .histogram-bar.bad { background: linear-gradient(to top, #ef4444, #f87171); }
    .histogram-bar.moderate { background: linear-gradient(to top, #f59e0b, #fcd34d); }
    .histogram-bar.good { background: linear-gradient(to top, #22c55e, #86efac); }
    .histogram-bar:hover {
        filter: brightness(1.1);
    }
    .histogram-label {
        margin-top: 8px;
        font-size: 12px;
        color: var(--gray-600);
    }
    .histogram-legend {
        display: flex;
        justify-content: center;
        gap: 24px;
        margin-top: 16px;
    }
    .histogram-legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray-600);
    }
    .histogram-legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .performers-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        margin-top: 16px;
    }
    .performer-card {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
        padding: 16px;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .performer-rank {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-700);
        background: rgba(16, 185, 129, 0.1);
        border-radius: 4px;
        padding: 4px 8px;
        margin-bottom: 8px;
    }
    .performer-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 4px;
    }
    .performer-score {
        font-size: 14px;
        color: var(--gray-700);
        margin-bottom: 8px;
    }
    .performer-dist-chart {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .performer-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .output-option.hide {
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: all 0.4s ease;
        filter: blur(2px);
    }

    .query-description {
        font-size: 13px;
        color: var(--gray-700);
        font-weight: 500;
        margin-bottom: 8px;
        line-height: 1.5;
        letter-spacing: 0.02em;
    }

    .output-description {
        font-size: 11px;
        color: var(--gray-500);
        font-weight: 400;
        margin-bottom: 8px;
        line-height: 1.4;
        letter-spacing: 0.01em;
    }

    /* Loading and empty states */
    .loading-container {
        text-align: center;
        padding: 40px 20px;
    }
    
    .loading-progress {
        width: 200px;
        height: 4px;
        background: var(--gray-200);
        border-radius: 2px;
        margin: 0 auto 16px;
        overflow: hidden;
    }
    
    .loading-progress-bar {
        width: 30%;
        height: 100%;
        background: var(--primary, #6366f1);
        animation: loading-move 2s infinite;
    }
    
    @keyframes loading-move {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(400%); }
    }
    
    .loading-text {
        color: var(--gray-600);
        font-size: 14px;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-600);
    }
    
    .empty-state h3 {
        color: var(--gray-900);
        margin-bottom: 8px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
        font-size: 14px;
    }
    
    .knowledge-analysis-table th,
    .knowledge-analysis-table td {
        padding: 8px 12px;
        border: 1px solid var(--gray-200);
        text-align: left;
    }
    
    .knowledge-analysis-table th {
        background: var(--gray-50);
        font-weight: 600;
    }
    
    /* Model name cell styling */
    .model-name-cell {
        background-color: var(--gray-50);
        font-weight: 600;
        color: var(--gray-700);
        text-align: left;
        padding-left: 10px;
        font-size: 11px;
        white-space: nowrap;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .chart-cell {
        padding: 4px 8px;
    }
    
    .no-data {
        text-align: center;
        color: var(--gray-500);
        font-style: italic;
        font-size: 11px;
    }
    
    /* Analysis stats cards */
    .analysis-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow-sm);
    }
    
    .stat-card.positive {
        border-color: #28a745;
        background-color: #f8fff9;
    }
    
    .stat-card.negative {
        border-color: #dc3545;
        background-color: #fff8f8;
    }
    
    .stat-card.neutral {
        border-color: var(--gray-400);
        background-color: var(--gray-50);
    }
    
    .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 14px;
        color: var(--gray-600);
        font-weight: 500;
    }
    
    .model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
    }
    
    /* Template header styles */
    .template-header-with-description {
        margin-bottom: 15px;
    }
    
    .template-header-link {
        color: var(--gray-900);
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .template-header-link:hover {
        color: var(--primary);
        text-decoration: underline;
    }
    
    .template-description-text {
        margin: 0;
        color: var(--gray-600);
        font-size: 13px;
        font-style: italic;
        line-height: 1.4;
    }
    
    /* Knowledge Analysis Container */
    .knowledge-analysis-container {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    /* Dynamic Stats Text */
    .dynamic-stats {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.05) 0%,
            rgba(168, 85, 247, 0.03) 50%,
            rgba(59, 130, 246, 0.05) 100%);
        border: 1px solid rgba(99, 102, 241, 0.1);
        border-radius: 12px;
        padding: 20px 28px;
        margin-bottom: 48px;
        font-size: 16px;
        line-height: 1.8;
        color: var(--gray-700);
    }
    
    /* Winner showcase */
    .winner-showcase {
        background: linear-gradient(135deg, 
            rgba(16, 185, 129, 0.05) 0%,
            rgba(34, 197, 94, 0.03) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 12px;
        padding: 24px;
        margin: 32px 0;
    }
    
    .winner-showcase h4 {
        color: var(--gray-900);
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 16px 0;
    }
    
    .winner-example {
        display: flex;
        align-items: center;
        gap: 24px;
        margin-bottom: 16px;
    }
    
    .winner-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        font-size: 14px;
        color: var(--gray-900);
        min-width: 120px;
    }
    
    .winner-category {
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        min-width: 180px;
    }
    
    .winner-bar-chart {
        flex: 1;
        max-width: 400px;
    }
    
    .winner-description {
        font-size: 14px;
        color: var(--gray-600);
        line-height: 1.6;
        margin-top: 12px;
    }
    
    /* Expandable table */
    .table-controls {
        display: flex;
        justify-content: center;
        margin-top: 16px;
        margin-bottom: -1px;
    }
    
    .expand-button {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 8px 20px;
        font-size: 13px;
        font-weight: 500;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .expand-button:hover {
        background: var(--gray-50);
        color: var(--gray-900);
    }
    
    .expand-icon {
        width: 16px;
        height: 16px;
        transition: transform 0.3s ease;
    }
    
    .expand-button.expanded .expand-icon {
        transform: rotate(180deg);
    }
    
    .knowledge-analysis-table tbody tr.hidden-row {
        display: none;
    }
    
    .knowledge-analysis-table tbody tr.hidden-row.show {
        display: table-row;
    }
    
    .table-fade {
        position: relative;
    }
    
    .table-fade::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.9));
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .table-fade.expanded::after {
        opacity: 0;
    }
    
    .stat-value {
        display: inline-block;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(99, 102, 241, 0.1);
        border-radius: 6px;
        margin: 0 2px;
        padding: 2px 6px;
        font-size: inherit;
    }
    
    .model-highlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(124, 58, 237, 0.1);
        color: #7c3aed;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    .model-lowlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    /* Remove container styling from knowledge tables */
    .knowledge-analysis-table-wrapper {
        margin-bottom: 48px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
        background: var(--bg-primary);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .knowledge-analysis-table th {
        background: linear-gradient(to bottom, #f8f9fa, #f1f3f5);
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        border-bottom: 1px solid var(--gray-200);
    }
    
    .knowledge-analysis-table td {
        padding: 12px 20px;
        border-bottom: 1px solid var(--gray-100);
        vertical-align: middle;
    }
    
    .knowledge-analysis-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .knowledge-analysis-table tbody tr:hover {
        background: rgba(99, 102, 241, 0.02);
    }
    
    /* Template header without box */
    .template-section-header {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
    }
    
    .template-section-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0 0 8px 0;
    }
    
    .template-section-description {
        font-size: 14px;
        color: var(--gray-600);
        font-style: italic;
        margin: 0;
    }
    
    /* Enhanced bar chart styles */
    .bar-chart-container {
        width: 100%;
        height: 24px;
        background: var(--gray-100);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }
    
    .bar-chart-segments {
        display: flex;
        height: 100%;
        width: 100%;
    }
    
    .bar-segment {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        position: relative;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .bar-segment:hover {
        filter: brightness(1.1);
        z-index: 10;
    }
    
    .bar-segment.knowledge-moderate {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        color: #0c5460;
    }
    
    .bar-segment.knowledge-extensive {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
    }
    
    .bar-segment.knowledge-na {
        background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
        color: #383d41;
    }
    
    .bar-segment.knowledge-no-result,
    .bar-segment.knowledge-failed {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
    }
    
    .bar-number {
        font-size: 12px;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    .bar-segment:hover .bar-number,
    .bar-segment.show-number .bar-number {
        opacity: 1;
    }
    
    /* Quality score styling */
    .quality-score-cell {
        text-align: center;
        font-weight: 700;
        font-size: 14px;
    }
    
    .quality-score-value {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.1) 0%,
            rgba(168, 85, 247, 0.08) 100%);
        color: var(--primary);
        cursor: help;
        transition: all 0.2s ease;
    }
    
    .quality-score-value:hover {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.2) 0%,
            rgba(168, 85, 247, 0.15) 100%);
        transform: scale(1.05);
    }
    
    /* Compact Score Example */
    .score-example-compact {
        background: linear-gradient(135deg, 
            rgba(147, 51, 234, 0.05) 0%,
            rgba(99, 102, 241, 0.03) 100%);
        border: 1px solid rgba(147, 51, 234, 0.15);
        border-radius: 12px;
        padding: 20px;
        margin: 32px 0;
        font-size: 13px;
    }
    
    .score-example-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(147, 51, 234, 0.1);
    }
    
    .score-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .score-template-name {
        font-size: 12px;
        color: var(--gray-600);
        background: var(--gray-100);
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 500;
    }
    
    .score-breakdown-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
    }
    
    .score-type-breakdown {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
    }
    
    .score-type-title {
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 8px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .score-items {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 8px;
    }
    
    .score-item {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 11px;
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 4px;
        border: 1px solid transparent;
    }
    
    .score-item.good {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border-color: rgba(16, 185, 129, 0.2);
    }
    
    .score-item.caution {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border-color: rgba(245, 158, 11, 0.2);
    }
    
    .score-item.bad {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    .score-item.worst {
        background: rgba(127, 29, 29, 0.1);
        color: #991b1b;
        border-color: rgba(127, 29, 29, 0.2);
    }
    
    .score-subtotal {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 12px;
        text-align: right;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .score-final {
        background: var(--bg-primary);
        border: 2px solid rgba(147, 51, 234, 0.2);
        border-radius: 8px;
        padding: 12px 16px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }
    
    .score-calculation {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        color: var(--gray-700);
        font-weight: 500;
    }
    
    .score-result {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 6px 12px;
        border-radius: 6px;
    }
    
    @media (max-width: 768px) {
        .score-breakdown-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .score-example-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .score-final {
            flex-direction: column;
            gap: 8px;
        }
    }

    .experimental-flow-section {
        margin-top: 12px !important;
        margin-bottom: 48px;
        padding-top: 32px !important;
        padding-bottom: 60px;
    }
    .article-container > .article-main > article > p:last-of-type {
        margin-bottom: 10px !important;
    }

    .performer-score strong {
        font-weight: 700;
        color: var(--gray-900);
    }

    .worst-performer-section {
        margin: 32px 0;
    }
    .performer-card.worst {
        background: linear-gradient(135deg, #fff1f2, #ffe4e6);
        border-color: #fecaca;
    }
    .performer-card.worst .performer-rank {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
    }

    .histogram-section {
        margin: 48px 0;
        padding: 24px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
    }
    .histogram-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    .histogram-description {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 24px;
    }
    .histogram-chart {
        display: flex;
        align-items: flex-end;
        gap: 2px;
        height: 120px;
        border-bottom: 2px solid var(--gray-300);
        padding-bottom: 4px;
    }
    .histogram-bin {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        text-align: center;
    }
    .histogram-bar {
        width: 90%;
        background: linear-gradient(to top, var(--primary), #a78bfa);
        border-radius: 4px 4px 0 0;
        color: white;
        font-size: 12px;
        font-weight: 600;
        line-height: 1.5;
        padding-top: 4px;
        transition: all 0.2s ease;
        position: relative;
    }
    .histogram-bar.bad { background: linear-gradient(to top, #ef4444, #f87171); }
    .histogram-bar.moderate { background: linear-gradient(to top, #f59e0b, #fcd34d); }
    .histogram-bar.good { background: linear-gradient(to top, #22c55e, #86efac); }
    .histogram-bar:hover {
        filter: brightness(1.1);
    }
    .histogram-label {
        margin-top: 8px;
        font-size: 12px;
        color: var(--gray-600);
    }
    .histogram-legend {
        display: flex;
        justify-content: center;
        gap: 24px;
        margin-top: 16px;
    }
    .histogram-legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray-600);
    }
    .histogram-legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .performers-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        margin-top: 16px;
    }
    .performer-card {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
        padding: 16px;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .performer-rank {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-700);
        background: rgba(16, 185, 129, 0.1);
        border-radius: 4px;
        padding: 4px 8px;
        margin-bottom: 8px;
    }
    .performer-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 4px;
    }
    .performer-score {
        font-size: 14px;
        color: var(--gray-700);
        margin-bottom: 8px;
    }
    .performer-dist-chart {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .performer-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .output-option.hide {
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: all 0.4s ease;
        filter: blur(2px);
    }

    .query-description {
        font-size: 13px;
        color: var(--gray-700);
        font-weight: 500;
        margin-bottom: 8px;
        line-height: 1.5;
        letter-spacing: 0.02em;
    }

    .output-description {
        font-size: 11px;
        color: var(--gray-500);
        font-weight: 400;
        margin-bottom: 8px;
        line-height: 1.4;
        letter-spacing: 0.01em;
    }

    /* Loading and empty states */
    .loading-container {
        text-align: center;
        padding: 40px 20px;
    }
    
    .loading-progress {
        width: 200px;
        height: 4px;
        background: var(--gray-200);
        border-radius: 2px;
        margin: 0 auto 16px;
        overflow: hidden;
    }
    
    .loading-progress-bar {
        width: 30%;
        height: 100%;
        background: var(--primary, #6366f1);
        animation: loading-move 2s infinite;
    }
    
    @keyframes loading-move {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(400%); }
    }
    
    .loading-text {
        color: var(--gray-600);
        font-size: 14px;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-600);
    }
    
    .empty-state h3 {
        color: var(--gray-900);
        margin-bottom: 8px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
        font-size: 14px;
    }
    
    .knowledge-analysis-table th,
    .knowledge-analysis-table td {
        padding: 8px 12px;
        border: 1px solid var(--gray-200);
        text-align: left;
    }
    
    .knowledge-analysis-table th {
        background: var(--gray-50);
        font-weight: 600;
    }
    
    /* Model name cell styling */
    .model-name-cell {
        background-color: var(--gray-50);
        font-weight: 600;
        color: var(--gray-700);
        text-align: left;
        padding-left: 10px;
        font-size: 11px;
        white-space: nowrap;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .chart-cell {
        padding: 4px 8px;
    }
    
    .no-data {
        text-align: center;
        color: var(--gray-500);
        font-style: italic;
        font-size: 11px;
    }
    
    /* Analysis stats cards */
    .analysis-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow-sm);
    }
    
    .stat-card.positive {
        border-color: #28a745;
        background-color: #f8fff9;
    }
    
    .stat-card.negative {
        border-color: #dc3545;
        background-color: #fff8f8;
    }
    
    .stat-card.neutral {
        border-color: var(--gray-400);
        background-color: var(--gray-50);
    }
    
    .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 14px;
        color: var(--gray-600);
        font-weight: 500;
    }
    
    .model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
    }
    
    /* Template header styles */
    .template-header-with-description {
        margin-bottom: 15px;
    }
    
    .template-header-link {
        color: var(--gray-900);
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .template-header-link:hover {
        color: var(--primary);
        text-decoration: underline;
    }
    
    .template-description-text {
        margin: 0;
        color: var(--gray-600);
        font-size: 13px;
        font-style: italic;
        line-height: 1.4;
    }
    
    /* Knowledge Analysis Container */
    .knowledge-analysis-container {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    /* Dynamic Stats Text */
    .dynamic-stats {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.05) 0%,
            rgba(168, 85, 247, 0.03) 50%,
            rgba(59, 130, 246, 0.05) 100%);
        border: 1px solid rgba(99, 102, 241, 0.1);
        border-radius: 12px;
        padding: 20px 28px;
        margin-bottom: 48px;
        font-size: 16px;
        line-height: 1.8;
        color: var(--gray-700);
    }
    
    /* Winner showcase */
    .winner-showcase {
        background: linear-gradient(135deg, 
            rgba(16, 185, 129, 0.05) 0%,
            rgba(34, 197, 94, 0.03) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 12px;
        padding: 24px;
        margin: 32px 0;
    }
    
    .winner-showcase h4 {
        color: var(--gray-900);
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 16px 0;
    }
    
    .winner-example {
        display: flex;
        align-items: center;
        gap: 24px;
        margin-bottom: 16px;
    }
    
    .winner-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        font-size: 14px;
        color: var(--gray-900);
        min-width: 120px;
    }
    
    .winner-category {
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        min-width: 180px;
    }
    
    .winner-bar-chart {
        flex: 1;
        max-width: 400px;
    }
    
    .winner-description {
        font-size: 14px;
        color: var(--gray-600);
        line-height: 1.6;
        margin-top: 12px;
    }
    
    /* Expandable table */
    .table-controls {
        display: flex;
        justify-content: center;
        margin-top: 16px;
        margin-bottom: -1px;
    }
    
    .expand-button {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 8px 20px;
        font-size: 13px;
        font-weight: 500;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .expand-button:hover {
        background: var(--gray-50);
        color: var(--gray-900);
    }
    
    .expand-icon {
        width: 16px;
        height: 16px;
        transition: transform 0.3s ease;
    }
    
    .expand-button.expanded .expand-icon {
        transform: rotate(180deg);
    }
    
    .knowledge-analysis-table tbody tr.hidden-row {
        display: none;
    }
    
    .knowledge-analysis-table tbody tr.hidden-row.show {
        display: table-row;
    }
    
    .table-fade {
        position: relative;
    }
    
    .table-fade::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.9));
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .table-fade.expanded::after {
        opacity: 0;
    }
    
    .stat-value {
        display: inline-block;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(99, 102, 241, 0.1);
        border-radius: 6px;
        margin: 0 2px;
        padding: 2px 6px;
        font-size: inherit;
    }
    
    .model-highlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(124, 58, 237, 0.1);
        color: #7c3aed;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    .model-lowlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    /* Remove container styling from knowledge tables */
    .knowledge-analysis-table-wrapper {
        margin-bottom: 48px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
        background: var(--bg-primary);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .knowledge-analysis-table th {
        background: linear-gradient(to bottom, #f8f9fa, #f1f3f5);
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        border-bottom: 1px solid var(--gray-200);
    }
    
    .knowledge-analysis-table td {
        padding: 12px 20px;
        border-bottom: 1px solid var(--gray-100);
        vertical-align: middle;
    }
    
    .knowledge-analysis-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .knowledge-analysis-table tbody tr:hover {
        background: rgba(99, 102, 241, 0.02);
    }
    
    /* Template header without box */
    .template-section-header {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
    }
    
    .template-section-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0 0 8px 0;
    }
    
    .template-section-description {
        font-size: 14px;
        color: var(--gray-600);
        font-style: italic;
        margin: 0;
    }
    
    /* Enhanced bar chart styles */
    .bar-chart-container {
        width: 100%;
        height: 24px;
        background: var(--gray-100);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }
    
    .bar-chart-segments {
        display: flex;
        height: 100%;
        width: 100%;
    }
    
    .bar-segment {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        position: relative;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .bar-segment:hover {
        filter: brightness(1.1);
        z-index: 10;
    }
    
    .bar-segment.knowledge-limited {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
    }
    
    .bar-segment.knowledge-moderate {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        color: #0c5460;
    }
    
    .bar-segment.knowledge-extensive {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
    }
    
    .bar-segment.knowledge-na {
        background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
        color: #383d41;
    }
    
    .bar-segment.knowledge-no-result,
    .bar-segment.knowledge-failed {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
    }
    
    .bar-number {
        font-size: 12px;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    .bar-segment:hover .bar-number,
    .bar-segment.show-number .bar-number {
        opacity: 1;
    }
    
    /* Quality score styling */
    .quality-score-cell {
        text-align: center;
        font-weight: 700;
        font-size: 14px;
    }
    
    .quality-score-value {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.1) 0%,
            rgba(168, 85, 247, 0.08) 100%);
        color: var(--primary);
        cursor: help;
        transition: all 0.2s ease;
    }
    
    .quality-score-value:hover {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.2) 0%,
            rgba(168, 85, 247, 0.15) 100%);
        transform: scale(1.05);
    }
    
    /* Compact Score Example */
    .score-example-compact {
        background: linear-gradient(135deg, 
            rgba(147, 51, 234, 0.05) 0%,
            rgba(99, 102, 241, 0.03) 100%);
        border: 1px solid rgba(147, 51, 234, 0.15);
        border-radius: 12px;
        padding: 20px;
        margin: 32px 0;
        font-size: 13px;
    }
    
    .score-example-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(147, 51, 234, 0.1);
    }
    
    .score-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .score-template-name {
        font-size: 12px;
        color: var(--gray-600);
        background: var(--gray-100);
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 500;
    }
    
    .score-breakdown-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
    }
    
    .score-type-breakdown {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
    }
    
    .score-type-title {
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 8px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .score-items {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 8px;
    }
    
    .score-item {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 11px;
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 4px;
        border: 1px solid transparent;
    }
    
    .score-item.good {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border-color: rgba(16, 185, 129, 0.2);
    }
    
    .score-item.caution {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border-color: rgba(245, 158, 11, 0.2);
    }
    
    .score-item.bad {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    .score-item.worst {
        background: rgba(127, 29, 29, 0.1);
        color: #991b1b;
        border-color: rgba(127, 29, 29, 0.2);
    }
    
    .score-subtotal {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 12px;
        text-align: right;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .score-final {
        background: var(--bg-primary);
        border: 2px solid rgba(147, 51, 234, 0.2);
        border-radius: 8px;
        padding: 12px 16px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }
    
    .score-calculation {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        color: var(--gray-700);
        font-weight: 500;
    }
    
    .score-result {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 6px 12px;
        border-radius: 6px;
    }
    
    @media (max-width: 768px) {
        .score-breakdown-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .score-example-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .score-final {
            flex-direction: column;
            gap: 8px;
        }
    }

    .experimental-flow-section {
        margin-top: 12px !important;
        margin-bottom: 48px;
        padding-top: 32px !important;
        padding-bottom: 60px;
    }
    .article-container > .article-main > article > p:last-of-type {
        margin-bottom: 10px !important;
    }

    .performer-score strong {
        font-weight: 700;
        color: var(--gray-900);
    }

    .worst-performer-section {
        margin: 32px 0;
    }
    .performer-card.worst {
        background: linear-gradient(135deg, #fff1f2, #ffe4e6);
        border-color: #fecaca;
    }
    .performer-card.worst .performer-rank {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
    }

    .histogram-section {
        margin: 48px 0;
        padding: 24px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
    }
    .histogram-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    .histogram-description {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 24px;
    }
    .histogram-chart {
        display: flex;
        align-items: flex-end;
        gap: 2px;
        height: 120px;
        border-bottom: 2px solid var(--gray-300);
        padding-bottom: 4px;
    }
    .histogram-bin {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        text-align: center;
    }
    .histogram-bar {
        width: 90%;
        background: linear-gradient(to top, var(--primary), #a78bfa);
        border-radius: 4px 4px 0 0;
        color: white;
        font-size: 12px;
        font-weight: 600;
        line-height: 1.5;
        padding-top: 4px;
        transition: all 0.2s ease;
        position: relative;
    }
    .histogram-bar.bad { background: linear-gradient(to top, #ef4444, #f87171); }
    .histogram-bar.moderate { background: linear-gradient(to top, #f59e0b, #fcd34d); }
    .histogram-bar.good { background: linear-gradient(to top, #22c55e, #86efac); }
    .histogram-bar:hover {
        filter: brightness(1.1);
    }
    .histogram-label {
        margin-top: 8px;
        font-size: 12px;
        color: var(--gray-600);
    }
    .histogram-legend {
        display: flex;
        justify-content: center;
        gap: 24px;
        margin-top: 16px;
    }
    .histogram-legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray-600);
    }
    .histogram-legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .performers-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        margin-top: 16px;
    }
    .performer-card {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
        padding: 16px;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .performer-rank {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-700);
        background: rgba(16, 185, 129, 0.1);
        border-radius: 4px;
        padding: 4px 8px;
        margin-bottom: 8px;
    }
    .performer-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 4px;
    }
    .performer-score {
        font-size: 14px;
        color: var(--gray-700);
        margin-bottom: 8px;
    }
    .performer-dist-chart {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .performer-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }

    .output-option.hide {
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: all 0.4s ease;
        filter: blur(2px);
    }

    .query-description {
        font-size: 13px;
        color: var(--gray-700);
        font-weight: 500;
        margin-bottom: 8px;
        line-height: 1.5;
        letter-spacing: 0.02em;
    }

    .output-description {
        font-size: 11px;
        color: var(--gray-500);
        font-weight: 400;
        margin-bottom: 8px;
        line-height: 1.4;
        letter-spacing: 0.01em;
    }

    /* Loading and empty states */
    .loading-container {
        text-align: center;
        padding: 40px 20px;
    }
    
    .loading-progress {
        width: 200px;
        height: 4px;
        background: var(--gray-200);
        border-radius: 2px;
        margin: 0 auto 16px;
        overflow: hidden;
    }
    
    .loading-progress-bar {
        width: 30%;
        height: 100%;
        background: var(--primary, #6366f1);
        animation: loading-move 2s infinite;
    }
    
    @keyframes loading-move {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(400%); }
    }
    
    .loading-text {
        color: var(--gray-600);
        font-size: 14px;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-600);
    }
    
    .empty-state h3 {
        color: var(--gray-900);
        margin-bottom: 8px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
        font-size: 14px;
    }
    
    .knowledge-analysis-table th,
    .knowledge-analysis-table td {
        padding: 8px 12px;
        border: 1px solid var(--gray-200);
        text-align: left;
    }
    
    .knowledge-analysis-table th {
        background: var(--gray-50);
        font-weight: 600;
    }
    
    /* Model name cell styling */
    .model-name-cell {
        background-color: var(--gray-50);
        font-weight: 600;
        color: var(--gray-700);
        text-align: left;
        padding-left: 10px;
        font-size: 11px;
        white-space: nowrap;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .chart-cell {
        padding: 4px 8px;
    }
    
    .no-data {
        text-align: center;
        color: var(--gray-500);
        font-style: italic;
        font-size: 11px;
    }
    
    /* Analysis stats cards */
    .analysis-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow-sm);
    }
    
    .stat-card.positive {
        border-color: #28a745;
        background-color: #f8fff9;
    }
    
    .stat-card.negative {
        border-color: #dc3545;
        background-color: #fff8f8;
    }
    
    .stat-card.neutral {
        border-color: var(--gray-400);
        background-color: var(--gray-50);
    }
    
    .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 14px;
        color: var(--gray-600);
        font-weight: 500;
    }
    
    .model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
    }
    
    /* Template header styles */
    .template-header-with-description {
        margin-bottom: 15px;
    }
    
    .template-header-link {
        color: var(--gray-900);
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .template-header-link:hover {
        color: var(--primary);
        text-decoration: underline;
    }
    
    .template-description-text {
        margin: 0;
        color: var(--gray-600);
        font-size: 13px;
        font-style: italic;
        line-height: 1.4;
    }
    
    /* Knowledge Analysis Container */
    .knowledge-analysis-container {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    /* Dynamic Stats Text */
    .dynamic-stats {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.05) 0%,
            rgba(168, 85, 247, 0.03) 50%,
            rgba(59, 130, 246, 0.05) 100%);
        border: 1px solid rgba(99, 102, 241, 0.1);
        border-radius: 12px;
        padding: 20px 28px;
        margin-bottom: 48px;
        font-size: 16px;
        line-height: 1.8;
        color: var(--gray-700);
    }
    
    /* Winner showcase */
    .winner-showcase {
        background: linear-gradient(135deg, 
            rgba(16, 185, 129, 0.05) 0%,
            rgba(34, 197, 94, 0.03) 100%);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 12px;
        padding: 24px;
        margin: 32px 0;
    }
    
    .winner-showcase h4 {
        color: var(--gray-900);
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 16px 0;
    }
    
    .winner-example {
        display: flex;
        align-items: center;
        gap: 24px;
        margin-bottom: 16px;
    }
    
    .winner-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        font-size: 14px;
        color: var(--gray-900);
        min-width: 120px;
    }
    
    .winner-category {
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        min-width: 180px;
    }
    
    .winner-bar-chart {
        flex: 1;
        max-width: 400px;
    }
    
    .winner-description {
        font-size: 14px;
        color: var(--gray-600);
        line-height: 1.6;
        margin-top: 12px;
    }
    
    /* Expandable table */
    .table-controls {
        display: flex;
        justify-content: center;
        margin-top: 16px;
        margin-bottom: -1px;
    }
    
    .expand-button {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 8px 20px;
        font-size: 13px;
        font-weight: 500;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .expand-button:hover {
        background: var(--gray-50);
        color: var(--gray-900);
    }
    
    .expand-icon {
        width: 16px;
        height: 16px;
        transition: transform 0.3s ease;
    }
    
    .expand-button.expanded .expand-icon {
        transform: rotate(180deg);
    }
    
    .knowledge-analysis-table tbody tr.hidden-row {
        display: none;
    }
    
    .knowledge-analysis-table tbody tr.hidden-row.show {
        display: table-row;
    }
    
    .table-fade {
        position: relative;
    }
    
    .table-fade::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.9));
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .table-fade.expanded::after {
        opacity: 0;
    }
    
    .stat-value {
        display: inline-block;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(99, 102, 241, 0.1);
        border-radius: 6px;
        margin: 0 2px;
        padding: 2px 6px;
        font-size: inherit;
    }
    
    .model-highlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(124, 58, 237, 0.1);
        color: #7c3aed;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    .model-lowlight {
        display: inline-block;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: inherit;
    }
    
    /* Remove container styling from knowledge tables */
    .knowledge-analysis-table-wrapper {
        margin-bottom: 48px;
    }
    
    .knowledge-analysis-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
        background: var(--bg-primary);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .knowledge-analysis-table th {
        background: linear-gradient(to bottom, #f8f9fa, #f1f3f5);
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-600);
        border-bottom: 1px solid var(--gray-200);
    }
    
    .knowledge-analysis-table td {
        padding: 12px 20px;
        border-bottom: 1px solid var(--gray-100);
        vertical-align: middle;
    }
    
    .knowledge-analysis-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .knowledge-analysis-table tbody tr:hover {
        background: rgba(99, 102, 241, 0.02);
    }
    
    /* Template header without box */
    .template-section-header {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
    }
    
    .template-section-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0 0 8px 0;
    }
    
    .template-section-description {
        font-size: 14px;
        color: var(--gray-600);
        font-style: italic;
        margin: 0;
    }
    
    /* Enhanced bar chart styles */
    .bar-chart-container {
        width: 100%;
        height: 24px;
        background: var(--gray-100);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }
    
    .bar-chart-segments {
        display: flex;
        height: 100%;
        width: 100%;
    }
    
    .bar-segment {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        position: relative;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .bar-segment:hover {
        filter: brightness(1.1);
        z-index: 10;
    }
    
    .bar-segment.knowledge-limited {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
    }
    
    .bar-segment.knowledge-moderate {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        color: #0c5460;
    }
    
    .bar-segment.knowledge-extensive {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
    }
    
    .bar-segment.knowledge-na {
        background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
        color: #383d41;
    }
    
    .bar-segment.knowledge-no-result,
    .bar-segment.knowledge-failed {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
    }
    
    .bar-number {
        font-size: 12px;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    /* Quality score styling */
    .quality-score-cell {
        text-align: center;
        font-weight: 700;
        font-size: 14px;
    }
    
    .quality-score-value {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.1) 0%,
            rgba(168, 85, 247, 0.08) 100%);
        color: var(--primary);
        cursor: help;
        transition: all 0.2s ease;
    }
    
    .quality-score-value:hover {
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.2) 0%,
            rgba(168, 85, 247, 0.15) 100%);
        transform: scale(1.05);
    }
    
    /* Compact Score Example */
    .score-example-compact {
        background: linear-gradient(135deg, 
            rgba(147, 51, 234, 0.05) 0%,
            rgba(99, 102, 241, 0.03) 100%);
        border: 1px solid rgba(147, 51, 234, 0.15);
        border-radius: 12px;
        padding: 20px;
        margin: 32px 0;
        font-size: 13px;
    }
    
    .score-example-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(147, 51, 234, 0.1);
    }
    
    .score-model-name {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-weight: 600;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .score-template-name {
        font-size: 12px;
        color: var(--gray-600);
        background: var(--gray-100);
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 500;
    }
    
    .score-breakdown-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
    }
    
    .score-type-breakdown {
        background: var(--bg-primary);
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
    }
    
    .score-type-title {
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 8px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .score-items {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 8px;
    }
    
    .score-item {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 11px;
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 4px;
        border: 1px solid transparent;
    }
    
    .score-item.good {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border-color: rgba(16, 185, 129, 0.2);
    }
    
    .score-item.caution {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border-color: rgba(245, 158, 11, 0.2);
    }
    
    .score-item.bad {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    .score-item.worst {
        background: rgba(127, 29, 29, 0.1);
        color: #991b1b;
        border-color: rgba(127, 29, 29, 0.2);
    }
    
    .score-subtotal {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 12px;
        text-align: right;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .score-final {
        background: var(--bg-primary);
        border: 2px solid rgba(147, 51, 234, 0.2);
        border-radius: 8px;
        padding: 12px 16px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }
    
    .score-calculation {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        color: var(--gray-700);
        font-weight: 500;
    }
    
    .score-result {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
        background: rgba(147, 51, 234, 0.1);
        padding: 6px 12px;
        border-radius: 6px;
    }
    
    @media (max-width: 768px) {
        .score-breakdown-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .score-example-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .score-final {
            flex-direction: column;
            gap: 8px;
        }
    }

    .experimental-flow-section {
        margin-top: 12px !important;
        margin-bottom: 48px;
        padding-top: 32px !important;
        padding-bottom: 60px;
    }
    .article-container > .article-main > article > p:last-of-type {
        margin-bottom: 10px !important;
    }

    .performer-score strong {
        font-weight: 700;
        color: var(--gray-900);
    }

    .worst-performer-section {
        margin: 32px 0;
    }
    .performer-card.worst .performer-rank {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
    }

    .histogram-section {
        margin: 48px 0;
        padding: 24px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
    }
    .histogram-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    .histogram-description {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 24px;
    }
    .histogram-chart {
        display: flex;
        align-items: flex-end;
        gap: 2px;
        height: 120px;
        border-bottom: 2px solid var(--gray-300);
        padding-bottom: 4px;
    }
    .histogram-bin {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        text-align: center;
    }
    .histogram-bar {
        width: 90%;
        background: linear-gradient(to top, var(--primary), #a78bfa);
        border-radius: 4px 4px 0 0;
        color: white;
        font-size: 12px;
        font-weight: 600;
        line-height: 1.5;
        padding-top: 4px;
        transition: all 0.2s ease;
        position: relative;
    }
    .histogram-bar.bad { background: linear-gradient(to top, #ef4444, #f87171); }
    .histogram-bar.moderate { background: linear-gradient(to top, #f59e0b, #fcd34d); }
    .histogram-bar.good { background: linear-gradient(to top, #22c55e, #86efac); }
    .histogram-bar:hover {
        filter: brightness(1.1);
    }
    .histogram-label {
        margin-top: 8px;
        font-size: 12px;
        color: var(--gray-600);
    }
    .histogram-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
        margin-bottom: 16px;
    }
    .histogram-legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray-700);
    }
    .histogram-legend-color {
        width: 14px;
        height: 14px;
        border-radius: 4px;
        border: 1px solid rgba(0,0,0,0.1);
    }

    /* Experimental Flow Breakout (inside article) */
    .experimental-flow-breakout { }
</style>
{% endblock %}

{% block content %}
<!-- Background Animation -->
<canvas id="background-canvas" class="background-canvas"></canvas>

<!-- Main Content with proper spacing -->
<div class="main-content">
<!-- Hero Header - Full Width -->
<header class="hero-header">
    <canvas id="hero-canvas" class="hero-canvas"></canvas>
    <div class="hero-content">
        <h1 class="hero-title">Assessing LLM Knowledge Calibration for Microbial Taxonomxxxxx</h1>
            <div class="hero-author">by Philipp C. Mnch</div>
        <p class="hero-subtitle">
            A dual test set of synthetic species and verified bacteria reveals when the model invents and when it defers.
        </p>
    </div>
</header>

<div class="article-container">
    <!-- Main Content -->
    <div class="article-main">
        <!-- Article Content -->
        <article class="article-content">
        <!-- Purpose Section -->
        <section id="purpose" class="article-section">
            <h2 class="section-title">Hallucination Check: Fictional Strain Names
            </h2>
            
            <div class="article-text">
                <p>
                    <p>Microbial informationlike whether Pseudomonas putida degrades specific chemicalsis dispersed across many databases, research papers, and supplemental documents. There's no single comprehensive source, making it difficult and time-consuming to compile accurate annotations for microbial databases.
                    </p>

                    <p> 
                        In practice, microbiologists gather strain-level details from a fragmented landscape: taxonomic registries (NCBI, LPSN), commercial culture collections (ATCC, DSMZ), hidden genome annotations, and thousands of scientific papers. With no centralized, consistently formatted repository, even routine checkssuch as verifying antibiotic resistance or metabolic traitsrequire extensive manual cross-referencing.
                    </p>


               
                
                    <div class="callout callout-definition">
                        <div class="callout-header">Definition</div>
                        <div class="callout-content">
                            <strong>Binomial names</strong> are the universal "first&nbsp;and&nbsp;last names" of every micro-organism, inherited from Linnaean taxonomy. 
                            The first word (the <em>genus</em>) is always capitalised and groups together species that share a close evolutionary lineage<em>Escherichia</em>, for example, gathers gut-dwelling rods such as <em>E.&nbsp;coli</em> and <em>E.&nbsp;albertii</em>. 
                            The second word (the <em>species epithet</em>) is lowercase and distinguishes one member of the genus from another. 
                            Written in italics and fixed in Latin-style form, the pair becomes a legally recognised label once it is published in the <em>International Journal of Systematic and Evolutionary Microbiology</em> and entered into registries such as NCBI or LPSN. 
                            Because the format is rigid and globally standardised, even a newly coined species should "look right" at a glance; that visual regularity is exactly what makes it possible for an LLMand sometimes a human readerto mistake a well-crafted fiction for an authentic taxon.
                        </div>
                    </div>
    


                    <p>AI language models have absorbed extensive scientific literature and could potentially streamline this consolidation process. However, they often write with convincing authority even when evidence is thin, risking the introduction of incorrect detailsa phenomenon known as hallucination. This frequently occurs after Reinforcement Learning from Human Feedback (RLHF) training, where models are rewarded for sounding helpful and confident, even if "I don't know" would be more accurate. In microbiology, confident fabrications can be more harmful than no answer at all.
                    </p>

                    <div class="callout callout-definition">
                        <div class="callout-header">Definition</div>
                        <div class="callout-content">
                             <b> Hallucination (LLM):</b> A response that looks plausible and is delivered with full confidence, yet is wholly or partly fabricated and unsupported by any real source. This is especially problematic in scientific settings, where downstream decisions rely on accuracy.
                        </div>
                    </div>


                    <p> Understanding how often a model fabricates traits for nonexistent organisms is crucial before relying on its summaries for real-world microbial annotation
                    </p>
    
                 
                    
                </p>
            
                <p>
                    To probe where certainty ends and storytelling begins, we built a library of 200 wholly invented strain names, arranged along a realism gradient. At the playful end sit English mash-ups such as Crimson Horizon or Silver Pinelabels no taxonomist would buy. At the serious end are Latin-looking binomials like Luminaricella splendens that follow every rule of bacterial nomenclature. By asking the same set of questions across this spectrum, we can see exactly when an LLM's confidence tips into hallucination.
                </p>

                <div class="callout callout-definition callout-compact">
                    <div class="callout-content">
                        <div class="callout-content">
                            <b> How we minted our "fake bugs":</b> We programmatically stitched together Latin roots and taxonomic endings to forge binomial names that look legitimate but are absent from NCBI, LPSN, ATCC, and every other recognised database. This synthetic, ground-truth negative set lets us ask: can an LLM tell an authentic species from a skilfully fabricated one?
                        <div class="species-animation-container">
                            
                            <div class="species-animated">
                                <span class="genus-part" id="genus-text">Escherichia</span>
                                <span class="species-part" id="species-text">coli</span>
                            </div>
                            <div class="animation-label" id="animation-label">Real bacterial species</div>
                        </div>
                    </div>
                </div>

            </div>
                <p>
                    We repeated the name-minting process four times, each run following a different recipe and yielding fifty strains. The first batch combines plain English words, producing labels that no one would confuse for Latin. The second stitches together two random Latin roots, giving every name a classical ring even though the genus is fictitious. In the third set we keep a real, well-known genus and attach a fabricated species epithet, creating hybrids that look half legitimate. The fourth flips the trick: an invented genus is paired with a real species epithet, completing a spectrum that spans obviously fake to taxonomist-plausible. The animation below flips through the four collections in sequence, showing how the linguistic realism ratchets up across the 200-name library.
                </p>


<!-- Animated Species Generation Visualization -->
<section class="species-generation-section" style="width:100%;padding:40px 0 0 0;">
    <div class="flow-diagram-wrapper">
            <div class="flow-diagram" style="justify-content: flex-start; gap: 32px;">
          <!-- Set 1: Two English Words -->
          <div class="flow-box" style="width: 320px; text-align: center;">
            <div class="query-title">Set 1</div>
            <div class="output-description">2 random English words</div>
            <div class="mini-boxes" id="set1-miniboxes" style="display:flex;justify-content:center;gap:2px;margin-bottom:8px;"></div>
            <div class="species-animated" id="set1-species" style="font-size: 20px;">Blue Apple</div>
            <div class="animation-label" id="set1-label">1/50</div>
          </div>
          <!-- Set 2: Two Latin Words -->
          <div class="flow-box" style="width: 320px; text-align: center;">
            <div class="query-title">Set 2</div>
            <div class="output-description">2 random Latin words</div>
            <div class="mini-boxes" id="set2-miniboxes" style="display:flex;justify-content:center;gap:2px;margin-bottom:8px;"></div>
            <div class="species-animated" id="set2-species" style="font-size: 20px;">Corpus magnum</div>
            <div class="animation-label" id="set2-label">1/50</div>
          </div>
          <!-- Set 3: Real genus + artificial species -->
          <div class="flow-box" style="width: 320px; text-align: center;">
            <div class="query-title">Set 3</div>
            <div class="output-description">Real genus + artificial (Latin) species</div>
            <div class="mini-boxes" id="set3-miniboxes" style="display:flex;justify-content:center;gap:2px;margin-bottom:8px;"></div>
            <div class="species-animated" id="set3-species" style="font-size: 20px;">Escherichia phantasmus</div>
            <div class="animation-label" id="set3-label">1/50</div>
          </div>
          <!-- Set 4: Artificial genus + real species -->
          <div class="flow-box" style="width: 320px; text-align: center;">
            <div class="query-title">Set 4</div>
            <div class="output-description">Artificial genus + real (Latin) species</div>
            <div class="mini-boxes" id="set4-miniboxes" style="display:flex;justify-content:center;gap:2px;margin-bottom:8px;"></div>
            <div class="species-animated" id="set4-species" style="font-size: 20px;">Pseudobacterium coli</div>
            <div class="animation-label" id="set4-label">1/50</div>
          </div>
          <div style="text-align:center;margin-top:18px;font-size:14px;color:var(--gray-600);">
          <span style="font-weight:600;">200 total transformations</span> &mdash; 50 for each set
        </div>
      </div>
    </div>
  </section>

  <p>
    To gauge how much an LLM "knows" about each invented microbe, we run the same handful of questions against every name in the library. Because the wording never changesonly the species placeholderthe answers are directly comparable. For each reply we record whether the model offers concrete details, hedges with uncertainty, or immediately admits it has no information. Summarising those outcomes across our realism gradient tells us exactly when the model starts hallucinating and when it sensibly says "I'm not sure."
</p>


    <div class="callout callout-definition callout-compact">
    <div class="callout-content">
      A <strong>query template</strong> is a fixed question format used to test a language model's knowledge, where only the <span style="background:var(--gray-200);border-radius:3px;padding:1px 5px;font-family:monospace;">species name</span> is replaced each time. For example:
      <div class="template-skeleton" style="margin:12px 0 0 0;padding:10px 14px;background:var(--gray-50);border-radius:5px;display:inline-block;min-width:320px;">
        <span style="color:var(--gray-600);">"What do you know about</span>
        <span class="skeleton species-skeleton" style="display:inline-block;width:110px;height:1.1em;background:linear-gradient(90deg,#e0e7ff 30%,#f3f4f6 60%,#e0e7ff 100%);border-radius:3px;vertical-align:middle;animation:skeleton-loading 1.2s infinite linear;">&nbsp;</span>
        <span style="color:var(--gray-600);">?"</span>
      </div>
      <style>
        @keyframes skeleton-loading {
          0% { background-position: -120px 0; }
          100% { background-position: 120px 0; }
        }
        .template-skeleton .species-skeleton {
          background-size: 220px 100%;
        }
      </style>
    </div>
  </div>



<p>
    Rather than grading a free-form essay, we ask the model to pick one of three
    machine-readable labels that capture how much information it claims to have:
    <strong>limited</strong>, <strong>intermediate</strong>, or
    <strong>extensive</strong>.  Using discrete categories keeps the output
    easy to parse and compare across 200 fictional names.
</p>



<p>
    We actually send <em>three</em> variants of the same question to each LLM:
    the first template forces a choice among the three knowledge levels and <em>does not</em>
    offer an "I don't know" escape hatch.  Templates&nbsp;2 and&nbsp;3 do include an
    <code>NA</code> option but differ in how much context they supply: Template&nbsp;2 is a short,
    one-line prompt, while Template&nbsp;3 adds brief definitions of what
    <strong>limited</strong>, <strong>intermediate</strong>, and
    <strong>extensive</strong> should cover.  Comparing answers across the
    trio shows whether the model's willingness to hallucinate drops when we give
    it an explicit path to refuse and when we clarify the scoring criteria.
</p>


<div class="callout callout-definition">
    <div class="callout-header">Knowledge-level keys</div>
    <div class="callout-content">
        <strong>Limited&nbsp;</strong>  "I know only basic facts or context."<br>
        <strong>Intermediate&nbsp;</strong>  "I can give several specific details."<br>
        <strong>Extensive&nbsp;</strong>  "I can provide in-depth, reference-level information."<br>
        <em>NA</em>  "I don't know / no information available." (Allowed only in Templates&nbsp;2&nbsp;and&nbsp;3)
    </div>
</div>

<p>
    Each query template is more than a single line of text: it is a three-part bundle that keeps the evaluation
    machine-readable. The <strong>system prompt</strong> sets the assistant's role,
    the <strong>user prompt</strong> holds the species placeholder, and a compact
    <strong>validation&nbsp;JSON</strong> lists the only labels the model is allowed to return
    (<code>limited</code>, <code>intermediate</code>, <code>extensive</code>,
    and&nbsp;<code>NA</code>).&nbsp;We ship three such bundles. Template&nbsp;1 omits the
    <em>NA</em> escape hatch, forcing a knowledge claim; Templates&nbsp;2 and&nbsp;3 keep the same labels
    but differ in how fully they describe each category to the model.
</p>


<!--  Wide interactive template viewer  -->
<div class="callout callout-template" id="tinyTemplateBrowser" style="max-width:900px;margin:24px auto;">
    <div class="callout-header" style="font-size:15px;font-weight:600;margin-bottom:10px;">
        Browse Knowledge Templates
    </div>

    <!-- Loading state -->
    <div id="templateLoadingState" style="text-align:center;padding:20px;color:var(--gray-600);">
        <div style="margin-bottom:8px;">Loading templates...</div>
        <div style="width:100px;height:4px;background:var(--gray-200);margin:0 auto;border-radius:2px;overflow:hidden;">
            <div style="width:30%;height:100%;background:var(--primary,#6366f1);animation:loadingMove 2s infinite;"></div>
        </div>
    </div>

    <!-- Controls (hidden initially) -->
    <div id="templateControls" class="modern-form-container" style="display:none;">
        <!-- Template selector -->
        <div class="modern-form-control">
            <label class="modern-form-label">
                Template
            </label>
            <select id="templateSelect" class="modern-select">
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>

        <!-- Part selector -->
        <div class="modern-form-control">
            <label class="modern-form-label">
                Template Part
            </label>
            <div id="partButtons" class="modern-button-group">
                <button data-part="system"     class="modern-button active">System</button>
                <button data-part="user"       class="modern-button">User</button>
                <button data-part="validation" class="modern-button">Validation</button>
            </div>
        </div>
    </div>

    <!-- Content pane (hidden initially) -->
    <pre id="templatePane"
         style="display:none;background:#f8f9fa;border:1px solid var(--gray-200);
                padding:16px;max-height:320px;overflow-y:auto;
                font-size:12px;line-height:1.45;
                font-family:'Menlo','Monaco','Ubuntu Mono',monospace;"></pre>

    <!-- Error state (hidden initially) -->
    <div id="templateErrorState" style="display:none;text-align:center;padding:20px;color:var(--gray-600);">
        <div style="margin-bottom:8px;color:#dc3545;">Failed to load templates</div>
        <div style="font-size:13px;">Please check if knowledge templates are configured in your system.</div>
    </div>
</div>

<script>
    /* ------- Real template viewer data loader ------- */
    let knowledgeTemplates = {};
    let templateNames = [];

    // Load real knowledge templates from the API
    async function loadKnowledgeTemplates() {
        try {
            const response = await fetch('/api/available_knowledge_templates');
            const data = await response.json();

            if (!data.success) {
                throw new Error(data.error || 'Failed to load templates');
            }

            knowledgeTemplates = data.templates;
            templateNames = Object.keys(knowledgeTemplates);

            if (templateNames.length === 0) {
                showErrorState('No knowledge templates found');
                return;
            }

            // Populate the template selector
            const sel = document.getElementById('templateSelect');
            sel.innerHTML = '';
            templateNames.forEach((templateName, index) => {
                const option = document.createElement('option');
                option.value = templateName;
                option.textContent = knowledgeTemplates[templateName].display_name;
                sel.appendChild(option);
            });

            // Show the controls and hide loading
            document.getElementById('templateLoadingState').style.display = 'none';
            document.getElementById('templateControls').style.display = 'flex';
            document.getElementById('templatePane').style.display = 'block';

            // Setup event listeners
            setupEventListeners();

            // Render the first template
            render();

        } catch (error) {
            console.error('Error loading knowledge templates:', error);
            showErrorState(error.message);
        }
    }

    function showErrorState(message) {
        document.getElementById('templateLoadingState').style.display = 'none';
        document.getElementById('templateControls').style.display = 'none';
        document.getElementById('templatePane').style.display = 'none';

        const errorDiv = document.getElementById('templateErrorState');
        errorDiv.style.display = 'block';
        errorDiv.querySelector('div').textContent = message;
    }

    function setupEventListeners() {
        const sel = document.getElementById('templateSelect');
        const buttons = document.querySelectorAll('#partButtons .modern-button');

        sel.addEventListener('change', render);

        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                buttons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                render();
            });
        });
    }

    function render() {
        const sel = document.getElementById('templateSelect');
        const pane = document.getElementById('templatePane');
        const activeButton = document.querySelector('#partButtons .modern-button.active');

        if (!sel.value || !knowledgeTemplates[sel.value] || !activeButton) {
            return;
        }

        const template = knowledgeTemplates[sel.value];
        const activePart = activeButton.dataset.part;

        let content = '';

        switch (activePart) {
            case 'system':
                content = template.system.content;
                break;
            case 'user':
                content = template.user.content;
                break;
            case 'validation':
                if (template.validation && template.validation.content) {
                    content = template.validation.content;
                } else {
                    content = '// No validation configuration found for this template\n// Add a validation config file to enable response validation';
                }
                break;
            default:
                content = 'Unknown template part';
        }

        pane.textContent = content;
    }

    // Load templates when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Small delay to ensure other scripts have initialized
        setTimeout(loadKnowledgeTemplates, 100);
    });
</script>

<p>
    With our 200 fabricated names in hand, we run a fully automated loop:  
    each name is inserted into every query template, each template is sent to every
    model exposed through the <strong>OpenRouter&nbsp;API</strong>, and every reply
    is stored with a timestamp and model ID.  A small validation script then checks
    whether the response is one of the allowed labels
    (<code>limited</code>, <code>intermediate</code>, <code>extensive</code>, or&nbsp;<code>NA</code>)
    and scores it against the ground truth (which, for fictional species, should be
    <code>NA</code> or <code>limited</code>).
</p>



<style>
@keyframes loadingMove {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(400%); }
}

/* Correlation performer cards - no background */
.performer-card-simple {
    background: transparent;
    border: 1px solid var(--gray-200);
    border-radius: 8px;
    padding: 16px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 16px;
}

.performer-card-simple:hover {
    border-color: var(--gray-300);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.performer-card-simple .performer-rank {
    font-size: 14px;
    font-weight: 600;
    color: var(--gray-700);
    background: var(--gray-100);
    border-radius: 4px;
    padding: 4px 8px;
    margin-bottom: 8px;
}

.performer-card-simple .performer-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 4px;
}

.performer-card-simple .performer-score {
    font-size: 14px;
    color: var(--gray-700);
    margin-bottom: 8px;
}
</style>
           
           
        </section>
        </article>
    </div>
    
    <!-- Sidebar for the section above -->
    <aside class="article-sidebar">
        <!-- Paper Info Card styled like TOC -->
        <div class="toc-card paper-info-toc-card" style="margin-top: 24px;">
            <div class="toc-header">
                <h3 class="toc-title">Paper Info</h3>
            </div>
            <div class="toc-content">
                <div class="paper-title" style="font-weight:600;color:#3730a3;margin-bottom:6px;">Comparative Assessment of Large Language Models for Microbial Phenotype Annotation
</div>
                <div class="paper-authors" style="font-size:13px;color:#6b7280;margin-bottom:10px;font-style:italic;">
                    P. C. Mnch*, N. Safaei, R. Mreches, M. Binder, Y. Han, G. Robertson, E. A. Franzosa, C. Huttenhower, A. C. McHardy*
                </div>
                <a href="https://doi.org/10.1234/llm-bioeval.2024" target="_blank" class="paper-doi-link" style="display:inline-block;background:#6366f1;color:#fff;font-size:13px;font-weight:500;padding:6px 14px;border-radius:8px;text-decoration:none;transition:background 0.2s;">
                    View DOI
                </a>
            </div>
        </div>
    </aside>
</div>



<!-- Experimental Flow Diagram (Full-width breakout) -->
<section class="experimental-flow-section">
    <div class="flow-diagram-wrapper">
        <div class="flow-diagram">
            <!-- Input Box -->
            <div class="flow-box flow-input">
                <div class="flow-species">Pseudobacterium imaginarius</div>
                <div class="flow-label">Completely fictional species</div>
            </div>
            
            <!-- Arrow 1 -->
            <div class="flow-arrow">
                <svg width="60" height="40" viewBox="0 0 60 40" fill="none">
                    <path d="M5 20 L45 20 M45 20 L38 13 M45 20 L38 27" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            
            <!-- Query Box -->
            <div class="flow-box flow-query">
                <div class="query-title">LLM Query</div>
                <div class="output-description">Fictional species embedded in queries<br>asking models to assess their knowledge level</div>
                <div class="query-templates">
                    <div class="query-template" data-query="1">
                        <span class="template-number">Q1</span>
                        <span class="template-type">no NA option</span>
                    </div>
                    <div class="query-template" data-query="2">
                        <span class="template-number">Q2</span>
                        <span class="template-type">with NA option short query</span>
                    </div>
                    <div class="query-template" data-query="3">
                        <span class="template-number">Q3</span>
                        <span class="template-type">with NA verbose query</span>
                    </div>
                </div>
            </div>
            
            <!-- Arrow 2 -->
            <div class="flow-arrow">
                <svg width="60" height="40" viewBox="0 0 60 40" fill="none">
                    <path d="M5 20 L45 20 M45 20 L38 13 M45 20 L38 27" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            
            <!-- Output Box -->
            <div class="flow-box flow-output">
                <div class="output-title">LLM Response</div>
                <div class="output-description">LLM response of the knowledge level<br>based on the query</div>
                <div class="output-options">
                    <div class="output-option caution" data-level="limited">
                        <span>Limited</span>
                        <div class="expectation-indicator">
                            <span class="expect-q1"></span>
                        </div>
                    </div>
                    <div class="output-option bad" data-level="moderate">
                        <span>Moderate</span>
                        <div class="expectation-indicator">
                            <span class="expect-none"></span>
                        </div>
                    </div>
                    <div class="output-option worst" data-level="extensive">
                        <span>Extensive</span>
                        <div class="expectation-indicator">
                            <span class="expect-none"></span>
                        </div>
                    </div>
                    <div class="output-option good" data-level="na">
                        <span>NA</span>
                        <div class="expectation-indicator">
                            <span class="expect-q2 expect-q3"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Legend -->
        <div class="flow-legend">
            <div class="legend-item">
                <span class="legend-symbol">Q1, Q2, Q3</span> = Query types
            </div>
            <div class="legend-item">
                <span class="legend-symbol"></span> = Expected best response
            </div>
            <div class="legend-item">
                <span class="legend-symbol"></span> = Hallucination (bad response)
            </div>
        </div>
    </div>



</section>

<!-- Resume article layout -->
<div class="article-container" style="padding-top: 0;">
    <div class="article-main">
        <article class="article-content">

    


          

            <div style="overflow: auto;">
                <!-- Score calculation example will be inserted here by JavaScript -->
                <div id="scoreExampleContainer" style="float: right; width: 400px; margin: 0 0 24px 32px; clear: right;"></div>

                <div class="article-text">
                    <p>To compare models on a single scale we devised a "hallucination-avoidance" score. Each response earns three points if the model refuses or returns <code>NA</code>, two points for a self-declared limited answer, one point for intermediate, and zero when it claims extensive knowledge. We then sum those points for every fictional name and divide by the number of prompts, yielding an average that ranges from 0 (pure fantasy) to 3 (perfect restraint). Thus a model that usually says "I don't know" or "limited" on fake species will hover near the high end of the scale, while one that invents rich detail will drift toward zero.</p>
                </div>
            </div>

            <div id="dynamicStatsText" class="article-text"></div>

            <!-- Placeholder for Top Performers -->
            <div id="topPerformersContainer"></div>

            <!-- Placeholder for Worst Performer -->
            <div id="worstPerformerContainer"></div>

            <!-- Placeholder for Histogram -->
            <div id="qualityScoreHistogramContainer"></div>

            <div class="article-text">
                <p>This scoring system allows us to quantify a model's tendency to assert knowledge about non-existent subjects. The visualizations above highlight the top and bottom performers in this test, revealing which models are more likely to falsely claim familiarity with artificial species. The histogram provides an overall look at the distribution of these 'hallucination-avoidance' scores across all tested models. These results help identify which models are better calibrated to admit the limits of their knowledge, a crucial characteristic for trustworthy scientific AI.</p>
            </div>
        
        </article>
    </div>
</div>



<!-- Knowledge Analysis Results (Full-width breakout) -->
<section class="section-full knowledge-analysis-section">
    <div class="section-content">
        <div class="article-text" style="margin-bottom: 48px;">
             
            <h2 class="section-title">Full Results of the Artificial Hallucination Test</h2>
            </h2>

            <p> Below, you can explore the complete results for all evaluated models across each of the three knowledge query templates. These tables allow you to compare every model's performance in detail, see how their responses are distributed, and examine their average quality scores for each template. Use this section to identify trends, outliers, and the overall calibration of each language model when faced with artificial species. </p>
            
        </div>
        <div id="knowledgeAnalysisContent">
            <div class="loading-container">
                <div class="loading-progress">
                    <div class="loading-progress-bar"></div>
                </div>
                <div class="loading-text">Loading knowledge analysis data...</div>
            </div>
        </div>
    </div>
</section>


<!-- Knowledge Analysis Results (Full-width breakout) -->
<section class="section-full knowledge-analysis-section" style="background: linear-gradient(to bottom, #f8f9fa, #ffffff); border-top: 1px solid var(--gray-200);">
    <div class="section-content">
        <div class="article-text" style="margin-bottom: 48px;">
             
            <h2 class="section-title">Web-Aligned Knowledge: Real Bacterial names vs. Google Counts
            </h2>
            </h2>

            <p>
                To assess how closely LLMs' self-reported knowledge matches the actual availability of information online, we conducted an analysis using thousands of real bacterial species (such as E. coli and Bacillus subtilis). For each species, we asked LLMs to indicate their knowledge level (Limited, Moderate, or Extensive), then measured how many Google search results exist for that species. By calculating the correlation between the models' confidence and the species' web presence, we can determine how well each model's knowledge claims are calibrated to real-world information. Models that report greater knowledge for well-documented speciesand less for obscure onesdemonstrate better alignment with the information landscape.
            </p>
            
        </div>
        

         <!-- Animated Flow (optional, static for now) -->
         <div class="experimental-flow-section" style="margin-bottom: 40px;">
            <div class="flow-diagram-wrapper">
                <!-- Grid correlation diagram -->
                <div class="flow-grid">
                    <!-- Species input spanning rows -->
                    <div class="flow-box flow-input grid-species">
                        <div class="flow-species">Bacillus subtilis</div>
                        <div class="flow-label">Real species</div>
                    </div>

                    <!-- Row 1: LLM Query path -->
                    <div class="flow-arrow" style="grid-row:1; grid-column:2;">
                        <svg width="60" height="40" viewBox="0 0 60 40" fill="none"><path d="M5 30 L35 10 M35 10 L25 10 M35 10 L35 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <div class="flow-box flow-query" style="grid-row:1; grid-column:3;">
                        <div class="query-title">LLM Query</div>
                        <div class="output-description">Ask model for knowledge level</div>
                    </div>
                    <div class="flow-arrow" style="grid-row:1; grid-column:4;">
                        <svg width="60" height="40" viewBox="0 0 60 40" fill="none"><path d="M5 20 L45 20 M45 20 L38 13 M45 20 L38 27" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <div class="flow-result-box" id="corr-llm-box" style="grid-row:1; grid-column:5;">
                        <div style="font-size: 10px; color: var(--gray-600); margin-bottom: 2px;">knowledge group</div>
                        <span class="output-option caution">Limited</span>
                    </div>
                    <div class="flow-arrow" style="grid-row:1; grid-column:6;">
                        <svg width="60" height="40" viewBox="0 0 60 40" fill="none"><path d="M5 10 L35 30 M35 30 L25 30 M35 30 L35 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>

                    <!-- Row 2: Web Search path -->
                    <div class="flow-arrow" style="grid-row:2; grid-column:2;">
                        <svg width="60" height="40" viewBox="0 0 60 40" fill="none"><path d="M5 10 L35 30 M35 30 L25 30 M35 30 L35 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <div class="flow-box flow-query" style="grid-row:2; grid-column:3;">
                        <div class="query-title">Web Search</div>
                        <div class="output-description">Count Google search results</div>
                    </div>
                    <div class="flow-arrow" style="grid-row:2; grid-column:4;">
                        <svg width="60" height="40" viewBox="0 0 60 40" fill="none"><path d="M5 20 L45 20 M45 20 L38 13 M45 20 L38 27" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <div class="flow-result-box" id="corr-web-box" style="grid-row:2; grid-column:5;">1.5&nbsp;M</div>
                    <div class="flow-arrow" style="grid-row:2; grid-column:6;">
                        <svg width="60" height="40" viewBox="0 0 60 40" fill="none"><path d="M5 30 L35 10 M35 10 L25 10 M35 10 L35 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>

                    <!-- Shared Correlation box -->
                    <div class="flow-box flow-output grid-correlation">
                        <div class="output-title">Correlation Analysis</div>
                    </div>
                </div>
                
                <!-- Legend -->
                <div class="flow-legend">
                    <div class="legend-item">
                        <span class="legend-symbol success">Extensive</span> + <span class="legend-symbol">High count</span> = Good calibration
                    </div>
                    <div class="legend-item">
                        <span class="legend-symbol caution">Limited</span> + <span class="legend-symbol">Low count</span> = Good calibration
                    </div>
                    <div class="legend-item">
                        <span class="legend-symbol">Pearson correlation</span> = Measures alignment
                    </div>
                </div>
            </div>
        </div>


        
        <div id="correlationDynamicStats" class="article-text" style="margin-bottom: 48px;">
            <!-- Dynamic text for correlation analysis will be injected here -->
        </div>

    </div>
</section>

<!-- Real Species Correlation Section -->
<section id="knowledge-web-alignment" class="section-full correlation-analysis-section" style="background: linear-gradient(to bottom, #f8f9fa, #ffffff); border-top: 1px solid var(--gray-200);">
    <div class="section-content">
        <div class="explanation-section">
            <div class="explanation-grid">
                
            </div>
        </div>
       
        <!-- Stats and Results -->
        <div id="correlationContent">
            <div class="loading-container">
                <div class="loading-progress">
                    <div class="loading-progress-bar"></div>
                </div>
                <div class="loading-text">Loading knowledge-web alignment data...</div>
            </div>
        </div>
    </div>
</section>



<!-- TOC Active State and Animations Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Template skeleton loading effect
    const templateShowcases = document.querySelectorAll('.template-showcase');
    templateShowcases.forEach((showcase, index) => {
        showcase.classList.add('loading');
        
        setTimeout(() => {
            showcase.classList.remove('loading');
        }, 1000 + (index * 500));
    });
    
    // Species name animation
    const genusElement = document.getElementById('genus-text');
    const speciesElement = document.getElementById('species-text');
    const labelElement = document.getElementById('animation-label');
    
    if (genusElement && speciesElement && labelElement) {
        const animationSteps = [
            { genus: 'Escherichia', species: 'coli', label: 'Real bacterial species', genusClass: '', speciesClass: '' },
            { genus: 'Escherichia', species: '<div class="skeleton-word" style="width: 80px;"></div>', label: 'Transforming species...', genusClass: '', speciesClass: '' },
            { genus: 'Escherichia', species: 'phantasmus', label: 'Real genus + fictional species', genusClass: '', speciesClass: 'fictional' },
            { genus: '<div class="skeleton-word" style="width: 120px;"></div>', species: 'phantasmus', label: 'Transforming genus...', genusClass: '', speciesClass: 'fictional' },
            { genus: 'Pseudobacterium', species: 'imaginarius', label: 'Completely fictional species', genusClass: 'fictional', speciesClass: 'fictional' }
        ];
        
        let currentStep = 0;
        
        function animateSpecies() {
            const step = animationSteps[currentStep];
            
            genusElement.innerHTML = step.genus;
            speciesElement.innerHTML = step.species;
            labelElement.textContent = step.label;
            
            genusElement.className = 'genus-part ' + step.genusClass;
            speciesElement.className = 'species-part ' + step.speciesClass;
            
            currentStep = (currentStep + 1) % animationSteps.length;
        }
        
        // Start animation after a delay
        setTimeout(() => {
            animateSpecies();
            setInterval(animateSpecies, 3000);
        }, 1500);
    }
    
    // Hero Header Animation
    const heroCanvas = document.getElementById('hero-canvas');
    if (heroCanvas) {
        const ctx = heroCanvas.getContext('2d');
        let width, height;
        let columns = [];
        
        const colors = [
            { r: 99, g: 102, b: 241 },
            { r: 168, g: 85, b: 247 },
            { r: 59, g: 130, b: 246 },
        ];
        
        function resizeHeroCanvas() {
            width = heroCanvas.width = heroCanvas.offsetWidth;
            height = heroCanvas.height = heroCanvas.offsetHeight;
            initHeroColumns();
        }
        
        function initHeroColumns() {
            columns = [];
            const columnWidth = 8;
            const gap = 2;
            const totalWidth = columnWidth + gap;
            const numColumns = Math.ceil(width / totalWidth);
            
            for (let i = 0; i < numColumns; i++) {
                const segments = [];
                const numSegments = 30;
                
                for (let j = 0; j < numSegments; j++) {
                    segments.push({
                        height: 3 + Math.random() * 12,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        offset: Math.random() * height
                    });
                }
                
                columns.push({
                    x: i * totalWidth,
                    segments: segments,
                    speed: 0.5 + Math.random() * 0.5
                });
            }
        }
        
        let heroFrame = 0;
        function animateHero() {
            if (heroFrame % 4 === 0) {  // Update every 4th frame for smoother animation
                ctx.clearRect(0, 0, width, height);
                
                columns.forEach(column => {
                    column.segments.forEach((segment, index) => {
                        const y = (segment.offset + heroFrame * column.speed * 0.08) % height;
                        
                        ctx.fillStyle = `rgba(${segment.color.r}, ${segment.color.g}, ${segment.color.b}, 0.4)`;
                        ctx.fillRect(column.x, y, 8, segment.height);
                    });
                });
            }
            
            heroFrame++;
            requestAnimationFrame(animateHero);
        }
        
        resizeHeroCanvas();
        animateHero();
        
        window.addEventListener('resize', () => {
            setTimeout(resizeHeroCanvas, 250);
        });
    }

    // DNA Background Animation
    const canvas = document.getElementById('background-canvas');
    if (canvas) {
        const ctx = canvas.getContext('2d');
        let width, height;
        let columns = [];
        
        const colors = [
            { r: 99, g: 102, b: 241 },
            { r: 168, g: 85, b: 247 },
            { r: 59, g: 130, b: 246 },
        ];
        
        function resizeCanvas() {
            width = canvas.width = 300;
            height = canvas.height = window.innerHeight;
            initColumns();
        }
        
        function initColumns() {
            columns = [];
            const columnWidth = 6;
            const gap = 3;
            const totalWidth = columnWidth + gap;
            const numColumns = Math.ceil(width / totalWidth);
            
            for (let i = 0; i < numColumns; i++) {
                const segments = [];
                const numSegments = 20;
                
                for (let j = 0; j < numSegments; j++) {
                    segments.push({
                        height: 3 + Math.random() * 8,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        offset: Math.random() * height,
                        alpha: 0.2 + Math.random() * 0.3
                    });
                }
                
                columns.push({
                    x: i * totalWidth,
                    segments: segments,
                    speed: 0.3 + Math.random() * 0.3
                });
            }
        }
        
        let frameCount = 0;
        function animate() {
            if (frameCount % 2 === 0) {  // Update ~30fps for smoother animation
                ctx.clearRect(0, 0, width, height);
                
                columns.forEach(column => {
                    column.segments.forEach((segment) => {
                        const y = (segment.offset + frameCount * column.speed * 0.1) % (height + 50);
                        
                        ctx.fillStyle = `rgba(${segment.color.r}, ${segment.color.g}, ${segment.color.b}, ${segment.alpha})`;
                        ctx.fillRect(column.x, y, 6, segment.height);
                    });
                });
            }
            
            frameCount++;
            requestAnimationFrame(animate);
        }
        
        resizeCanvas();
        animate();
        
        window.addEventListener('resize', () => {
            setTimeout(resizeCanvas, 250);
        });
    }
    
    // --- Species Generation Animation for 3 Sets ---
    // Set 1: Two random English words combined to form non-scientific names
    const set1Examples = [
        'Crimson Horizon', 'Velvet Thunder', 'Quantum Leap', 'Mystic River', 'Echo Valley',
        'Silent Peak', 'Azure Sky', 'Golden Dawn', 'Iron Gate', 'Silver Stream',
        'Winter Flame', 'Ember Wind', 'Crystal Shore', 'Shadow Frost', 'Ocean Mist',
        'Twilight Spark', 'Lunar Glow', 'Starlight Trail', 'Amber Field', 'Frost Wave',
        'Sunlit Path', 'Ember Grove', 'Misty Cove', 'Thunder Cloud', 'Sapphire Lake',
        'Obsidian Night', 'Whispering Sands', 'Radiant Forest', 'Diamond Ridge', 'Opal Waters',
        'Frozen Summit', 'Stormy Vista', 'Fiery Depths', 'Celestial Path', 'Verdant Cliffs',
        'Azure Depths', 'Twilight Meadow', 'Whisper Wind', 'Emerald Valley', 'Cobalt Plains',
        'Silver Pine', 'Jade Harbor', 'Ruby Sands', 'Ironwood Forest', 'Sapphire Peak',
        'Coral Reef', 'Ivory Coast', 'Onyx Hall', 'Goldenrod Hill', 'Midnight Sun'
    ];
    // Set 2: Completely fictional Latin-sounding binomial names with made-up genus and species
    const set2LatinExamples = [
        'Luminaricella splendens', 'Veloxigenium rapidus', 'Frigusoma glaciei', 'Ignicellula ardor', 'Solispira lumina',
        'Aurorabacillus albus', 'Aquavibrio unda', 'Ventiella zephyri', 'Arboricola silvae', 'Petraflexus saxi',
        'Luxbacillus fulgor', 'Nixicoccus nivalis', 'Calidibacter caloris', 'Sidereum ferrum', 'Gelubacillus frigidus',
        'Umbralevi umbrarum', 'Caelibacter caeli', 'Aquilonifer borealis', 'Luminoflora lux', 'Stellibacter astrum',
        'Crescobacter cresco', 'Flammabacter ignis', 'Monticola montis', 'Silvarumcella foresta', 'Ventusospira venti',
        'Arboribacter ligni', 'Siderosoma ferri', 'Fluminibacter fluvii', 'Glaeciabacter glacies', 'Ferrivibrio ferrum',
        'Temporibacter tempus', 'Radiobacillus radio', 'Ignispirillum igneus', 'Niveococcus niveus', 'Heliosoma solis',
        'Aquaspira aquae', 'Glaciigenium glacialis', 'Caelumcoccus aether', 'Lunabacter lunae', 'Terrafermentum terra',
        'Phosphoribacter phosphorus', 'Oralevi oralis', 'Aestusbacter aestus', 'Nubibacter nubes', 'Calorella calidus',
        'Tenebrisoma tenebrae', 'Polarisfermentum polus', 'Salumispira salum', 'Nocticella noctis', 'Firmamentibacter firmamentum'
    ];
    // Set 3: Real bacterial genus paired with fictional Latin species epithet
    const set2Examples = [
        'Bacillus splendens', 'Staphylococcus rapidus', 'Pseudomonas glaciei', 'Lactobacillus ardor', 'Rhodobacter lumina',
        'Escherichia albus', 'Streptococcus unda', 'Enterococcus zephyri', 'Klebsiella silvae', 'Serratia saxi',
        'Acinetobacter fulgor', 'Corynebacterium nivalis', 'Legionella caloris', 'Mycobacterium ferrum', 'Clostridium frigidus',
        'Vibrio umbrarum', 'Aeromonas caeli', 'Campylobacter borealis', 'Helicobacter lux', 'Neisseria astrum',
        'Salmonella cresco', 'Proteus ignis', 'Shigella montis', 'Haemophilus foresta', 'Yersinia venti',
        'Pasteurella ligni', 'Micrococcus ferri', 'Leuconostoc fluvii', 'Bacteroides glacies', 'Veillonella ferrum',
        'Fusobacterium tempus', 'Actinomyces radio', 'Bordetella igneus', 'Brucella niveus', 'Chlamydia solis',
        'Treponema aquae', 'Burkholderia glacialis', 'Francisella aether', 'Rickettsia lunae', 'Streptomyces terra',
        'Listeria phosphorus', 'Nocardia oralis', 'Spirochaeta aestus', 'Mycoplasma nubes', 'Anaplasma calidus',
        'Bartonella tenebrae', 'Chlamydophila polus', 'Eikenella salum', 'Gallionella noctis', 'Xanthomonas firmamentum'
    ];
    // Set 4: Fictional Latin genus paired with real bacterial species epithet
    const set3Examples = [
        'Luminaricella coli', 'Veloxigenium aeruginosa', 'Frigusoma putida', 'Ignicellula acidilactici', 'Solispira typhimurium',
        'Aurorabacillus subtilis', 'Aquavibrio cholerae', 'Ventiella faecalis', 'Arboricola pneumoniae', 'Petraflexus fragilis',
        'Luxbacillus cereus', 'Nixicoccus aureus', 'Calidibacter thermophilus', 'Sidereum metallidurans', 'Gelubacillus licheniformis',
        'Umbralevi influenzae', 'Caelibacter perfringens', 'Aquilonifer dysenteriae', 'Luminoflora rhamnosus', 'Stellibacter agalactiae',
        'Crescobacter plantarum', 'Flammabacter pyogenes', 'Monticola anthracis', 'Silvarumcella tularensis', 'Ventusospira typhi',
        'Arboribacter melitensis', 'Siderosoma enteritidis', 'Fluminibacter meningitidis', 'Glaeciabacter megaterium', 'Ferrivibrio vulnificus',
        'Temporibacter coli', 'Radiobacillus difficile', 'Ignispirillum jirovecii', 'Niveococcus pneumoniae', 'Heliosoma epidermidis',
        'Aquaspira mirabilis', 'Glaciigenium thermoglucosidasius', 'Caelumcoccus sporogenes', 'Lunabacter monocytogenes', 'Terrafermentum diphtheriae',
        'Phosphoribacter salmonis', 'Oralevi oralis', 'Aestusbacter haemolyticus', 'Nubibacter suis', 'Calorella botulinum',
        'Tenebrisoma palustris', 'Polarisfermentum maltophilia', 'Salumispira marcescens', 'Nocticella legionellae', 'Firmamentibacter cloacae'
    ];
    function createMiniBoxes(miniBoxId, totalBoxes) {
        const container = document.getElementById(miniBoxId);
        if (!container) return;
        container.innerHTML = '';
        for (let i = 0; i < totalBoxes; i++) {
            const box = document.createElement('div');
            box.className = 'mini-box';
            box.style.width = '12px';
            box.style.height = '12px';
            box.style.borderRadius = '3px';
            box.style.background = 'var(--gray-200)';
            box.style.transition = 'background 0.2s';
            container.appendChild(box);
        }
    }
    function animateSet(speciesList, speciesId, labelId, miniBoxId, artificialMode) {
        let idx = 0;
        const total = speciesList.length;
        const speciesElem = document.getElementById(speciesId);
        const labelElem = document.getElementById(labelId);
        const miniBoxCount = 15;
        createMiniBoxes(miniBoxId, miniBoxCount);
        const miniBoxes = document.getElementById(miniBoxId)?.children;
        function formatSpecies(name) {
            const parts = name.split(' ');
            if (artificialMode === 'both') {
                // Set 1: both words artificial
                return `<span class="artificial-part">${parts[0]}</span> <span class="artificial-part">${parts[1] || ''}</span>`;
            } else if (artificialMode === 'species') {
                // Set 2: species (second word) artificial
                return `${parts[0]} <span class="artificial-part">${parts[1] || ''}</span>`;
            } else if (artificialMode === 'genus') {
                // Set 3: genus (first word) artificial
                return `<span class="artificial-part">${parts[0]}</span> ${parts[1] || ''}`;
            }
            return name;
        }
        function next() {
            if (speciesElem) speciesElem.innerHTML = formatSpecies(speciesList[idx]);
            if (labelElem) labelElem.textContent = `${idx+1}/50`;
            // Highlight mini-box
            if (miniBoxes) {
                for (let i = 0; i < miniBoxCount; i++) {
                    miniBoxes[i].style.background = 'var(--gray-200)';
                }
                // Each mini-box represents ~3.33 steps
                const boxIdx = Math.floor(idx / (total / miniBoxCount));
                if (miniBoxes[boxIdx]) {
                    miniBoxes[boxIdx].style.background = 'var(--primary, #6366f1)';
                }
            }
            idx = (idx + 1) % total;
        }
        next();
        setInterval(next, 1200);
    }
    animateSet(set1Examples, 'set1-species', 'set1-label', 'set1-miniboxes', 'both');
    animateSet(set2LatinExamples, 'set2-species', 'set2-label', 'set2-miniboxes', 'both');
    animateSet(set2Examples, 'set3-species', 'set3-label', 'set3-miniboxes', 'species');
    animateSet(set3Examples, 'set4-species', 'set4-label', 'set4-miniboxes', 'genus');
    // --- End Species Generation Animation ---
    
    function createBarChartLegend() {
        return `
            <div style="display: flex; flex-wrap: wrap; gap: 16px; align-items: center; margin-bottom: 16px; margin-top: 4px; padding-left: 4px;">
                <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model can provide in-depth, reference-level information.">
                    <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);"></div>
                    <span>Extensive</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model can give several specific details.">
                    <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);"></div>
                    <span>Moderate</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model knows only basic facts or context.">
                    <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);"></div>
                    <span>Limited</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model doesn't know or no information available.">
                    <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);"></div>
                    <span>NA</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model failed to generate a response or the response was not valid.">
                    <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);"></div>
                    <span>Failed</span>
                </div>
            </div>
        `;
    }
    
    // --- Knowledge Analysis Data Fetch and Render (Using Working Version Logic) ---
    function formatTypeName(typeName) {
        // Format type names for display
        const typeDescriptions = {
            'random_words': 'Random Words',
            'latin_random_words': 'Fictional Latin',
            'real_genus_latin_strain': 'Real Genus + Fake Species',
            'latin_genus_real_strain': 'Fake Genus + Real Species'
        };
        return typeDescriptions[typeName] || typeName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    }
    
    function loadKnowledgeAnalysisData() {
        const container = document.getElementById('knowledgeAnalysisContent');
        
        console.log('Starting to load knowledge analysis data...');
        
        // Add timeout for loading
        const loadingTimeout = setTimeout(() => {
            container.innerHTML = `<div class="empty-state"><h3>Loading is taking longer than expected</h3><p>Please check your connection and try refreshing the page.</p></div>`;
        }, 10000); // 10 second timeout
        
        // Fetch knowledge analysis data
        fetch('/api/knowledge_analysis_data')
            .then(response => {
                clearTimeout(loadingTimeout);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Knowledge analysis data received:', data);
                
                if (data.error) {
                    container.innerHTML = `<div class="empty-state"><h3>Error loading knowledge analysis</h3><p>${data.error}</p></div>`;
                    return;
                }
                
                const knowledgeData = data.knowledge_analysis;
                
                if (!knowledgeData || Object.keys(knowledgeData).length === 0) {
                    container.innerHTML = '<div class="empty-state"><h3>No knowledge level data available</h3><p>Process some species with knowledge templates to see the analysis.</p></div>';
                    return;
                }
                
                // Store data globally for dataset switching
                window.knowledgeAnalysisData = data;
                
                // Render the analysis interface
                renderKnowledgeAnalysisInterface(data);
            })
            .catch(error => {
                clearTimeout(loadingTimeout);
                console.error('Error loading knowledge analysis:', error);
                container.innerHTML = `<div class="empty-state"><h3>Error loading knowledge analysis</h3><p>${error.message}</p></div>`;
            });
    }
    
    function renderKnowledgeAnalysisInterface(data) {
        const container = document.getElementById('knowledgeAnalysisContent');
        const knowledgeData = data.knowledge_analysis;
        const fileList = data.file_list || Object.keys(knowledgeData);
        
        console.log('Rendering knowledge analysis interface with files:', fileList);
        
        // Clear the container first
        container.innerHTML = '';
        
        let html = '';
        
        // Content for analysis by species type
        html += '<div id="artificalAnalysisContent">';
        html += '</div>';
        
        container.innerHTML = html;
        
        // Find and render only files that have type columns
        const filesWithTypes = fileList.filter(file => {
            const fileData = knowledgeData[file];
            return fileData && fileData.has_type_column;
        });
        
        if (filesWithTypes.length > 0) {
            // For simplicity, show the first file with type data
            const selectedFile = filesWithTypes[0];
            renderDatasetAnalysis(selectedFile, knowledgeData);
        } else {
            // Show message if no files have type data
            document.getElementById('artificalAnalysisContent').innerHTML = 
                '<div class="empty-state"><h3>No data with species types found</h3><p>Upload data files with type columns to see analysis by species type.</p></div>';
        }
    }
    
    function renderDatasetAnalysis(selectedFile, knowledgeData) {
        const contentContainer = document.getElementById('artificalAnalysisContent');
        const fileData = knowledgeData[selectedFile];
        
        if (!fileData || !fileData.types || !fileData.has_type_column) {
            contentContainer.innerHTML = '<div class="empty-state"><h3>No type data available for selected dataset</h3></div>';
            return;
        }
        
        const displayName = selectedFile.replace(/\.(txt|csv)$/i, '');
        let html = '';
        
        // Reorganize data by model and input type
        const modelData = {};
        const inputTypeSet = new Set();
        const templates = new Set();
        
        Object.entries(fileData.types).forEach(([inputType, templateData]) => {
            inputTypeSet.add(inputType);
            Object.entries(templateData).forEach(([templateName, models]) => {
                templates.add(templateName);
                Object.entries(models).forEach(([modelName, stats]) => {
                    if (!modelData[modelName]) {
                        modelData[modelName] = {};
                    }
                    if (!modelData[modelName][templateName]) {
                        modelData[modelName][templateName] = {};
                    }
                    modelData[modelName][templateName][inputType] = stats;
                });
            });
        });
        
        const inputTypeArray = Array.from(inputTypeSet).sort();
        const templateArray = Array.from(templates).sort();
        
        // Calculate statistics for the stats cards
        let totalModels = Object.keys(modelData).length;
        let totalTemplates = templateArray.length;
        let bestModel = null;
        let worstModel = null;
        let bestScore = -1;
        let worstScore = 4; // Start with max possible score
        
        // Find best and worst models for the dynamic text
        Object.entries(modelData).forEach(([modelName, templates]) => {
            let totalScore = 0;
            let totalSamples = 0;
            
            templateArray.forEach(templateName => {
                if (templates[templateName]) {
                    inputTypeArray.forEach(inputType => {
                        const data = templates[templateName][inputType];
                        if (data) {
                            const naFailedCount = (data.NA || 0) + (data.no_result || 0) + (data.inference_failed || 0);
                            const limitedCount = data.limited || 0;
                            const moderateCount = data.moderate || 0;
                            const extensiveCount = data.extensive || 0;
                            
                            totalScore += (naFailedCount * 3) + (limitedCount * 2) + (moderateCount * 1) + (extensiveCount * 0);
                            totalSamples += data.total || 0;
                        }
                    });
                }
            });
            
            if (totalSamples > 0) {
                const averageScore = totalScore / totalSamples;
                if (averageScore > bestScore) {
                    bestScore = averageScore;
                    bestModel = modelName.split('/').pop();
                }
                if (averageScore < worstScore) {
                    worstScore = averageScore;
                    worstModel = modelName.split('/').pop();
                }
            }
        });
        
        // Add dynamic statistics text
        const dynamicStatsText =
            `In total, we analyzed <span class="stat-value">${totalModels}</span> language models across ` +
            `<span class="stat-value">${totalTemplates}</span> different query templates and calculated for each model this score. ` +
            (bestModel ? `The top performers are those that consistently identified fictional species as unknown, achieving the highest scores. Under all evaluated models, the best one was <span class="model-highlight">${bestModel}</span> ` +
                `with an average quality score of <span class="stat-value">${bestScore.toFixed(2)}</span>, ` +
                `correctly identifying most artificial species as non-existent. ` : '') +
            (worstModel && worstModel !== bestModel ? `In contrast, <span class="model-lowlight">${worstModel}</span> ` +
                `performed poorly with a score of <span class="stat-value">${worstScore.toFixed(2)}</span>, ` +
                `frequently hallucinating information about fake bacteria.` : '');
        const statsTarget = document.getElementById('dynamicStatsText');
        if (statsTarget) statsTarget.innerHTML = dynamicStatsText;
        
        // Add tables without header since dataset is shown in dynamic stats
        html += renderTemplateAnalysisTables(templateArray, inputTypeArray, modelData);
        
        contentContainer.innerHTML = html;

        // --- Calculate overall model scores for rankings and histogram ---
        const overallModelScores = {};
        Object.entries(modelData).forEach(([modelName, templates]) => {
            let totalScore = 0;
            let totalSamples = 0;
            let dist = { NA: 0, limited: 0, moderate: 0, extensive: 0, no_result: 0, inference_failed: 0, total: 0 };

            Object.values(templates).forEach(templateData => {
                Object.values(templateData).forEach(stats => {
                    const naFailedCount = (stats.NA || 0) + (stats.no_result || 0) + (stats.inference_failed || 0);
                    const limitedCount = stats.limited || 0;
                    const moderateCount = stats.moderate || 0;
                    const extensiveCount = stats.extensive || 0;
                    totalScore += (naFailedCount * 3) + (limitedCount * 2) + (moderateCount * 1) + (extensiveCount * 0);
                    totalSamples += stats.total || 0;

                    dist.NA += stats.NA || 0;
                    dist.limited += stats.limited || 0;
                    dist.moderate += stats.moderate || 0;
                    dist.extensive += stats.extensive || 0;
                    dist.no_result += stats.no_result || 0;
                    dist.inference_failed += stats.inference_failed || 0;
                    dist.total += stats.total || 0;
                });
            });
            if (totalSamples > 0) {
                overallModelScores[modelName] = {
                    averageQualityScore: totalScore / totalSamples,
                    totalSamples: totalSamples,
                    distribution: dist
                };
            }
        });

        const sortedModels = Object.entries(overallModelScores)
            .map(([modelName, scores]) => ({ modelName, ...scores }))
            .sort((a, b) => b.averageQualityScore - a.averageQualityScore);

        // --- Render Top 4 Performers ---
        const top4Models = sortedModels.slice(0, 4);
        if (top4Models.length > 0) {
            let topPerformersHtml = `
                <div class="top-performers-section">
                    <h3 class="section-title" style="text-align: left; font-size: 24px; margin-bottom: 8px;">Top Performing Models</h3>
                    <p class="article-text" style="margin-bottom: 24px;">To create an overall ranking, we average each model's quality score across all query templates. The top performers are those that consistently identified fictional species as unknown, achieving the highest scores.</p>
                    ${createBarChartLegend()}
                    <div class="performers-list">
            `;
            top4Models.forEach((model, index) => {
                const displayName = model.modelName.split('/').pop();
                topPerformersHtml += `
                    <div class="performer-card">
                        <div class="performer-rank">${index + 1}</div>
                        <div style="flex: 1;">
                            <div class="performer-name">${displayName}</div>
                            <div class="performer-score">Avg. Quality Score: <strong>${model.averageQualityScore.toFixed(2)}</strong></div>
                            <div class="performer-dist-chart" style="margin-top: 12px;">
                                ${createKnowledgeBarChart(model.distribution)}
                            </div>
                        </div>
                    </div>
                `;
            });
            topPerformersHtml += `
                    </div>
                </div>
            `;
            
            const container = document.getElementById('topPerformersContainer');
            if (container) {
                container.innerHTML = topPerformersHtml;
            }
        }

        // --- Render Worst 2 Performers ---
        const worst2Models = sortedModels.length > 5 ? sortedModels.slice(-2) : [];
        if (worst2Models.length > 0) {
            let worstPerformersHtml = `
                <div class="worst-performer-section">
                    <p class="article-text">However, there is a significant difference in how models perform. The models with the most room for improvement are:</p>
                    <div class="performers-list">
            `;
            worst2Models.reverse().forEach((model, index) => {
                const rank = sortedModels.length - index;
                const displayName = model.modelName.split('/').pop();
                worstPerformersHtml += `
                    <div class="performer-card worst">
                        <div class="performer-rank">${rank}</div>
                        <div style="flex: 1;">
                            <div class="performer-name">${displayName}</div>
                            <div class="performer-score">Avg. Quality Score: <strong>${model.averageQualityScore.toFixed(2)}</strong></div>
                            <div class="performer-dist-chart" style="margin-top: 12px;">
                                ${createKnowledgeBarChart(model.distribution)}
                            </div>
                        </div>
                    </div>
                `;
            });
            worstPerformersHtml += `
                    </div>
                </div>
            `;
            const worstContainer = document.getElementById('worstPerformerContainer');
            if (worstContainer) {
                worstContainer.innerHTML = worstPerformersHtml;
            }
        }

        
        // Finally, render the score example box
        renderScoreExample(modelData, templateArray, inputTypeArray);
    }

    function generateScoreExampleHTML(modelData, templateArray, inputTypeArray) {
        const modelNames = Object.keys(modelData);
        let scoreExampleHtml = '';
        if (modelNames.length > 0 && templateArray.length > 0) {
            // Pick a random model for the example
            const randomModelName = modelNames[Math.floor(Math.random() * modelNames.length)];
            const randomModel = modelData[randomModelName];
            const firstTemplate = templateArray[0];
            
                             if (randomModel && randomModel[firstTemplate]) {
                scoreExampleHtml += '<div class="callout callout-template" style="width: 100%; margin: 0;">';
                
                // Header with reload button
                scoreExampleHtml += `
                    <div class="callout-header" style="display: flex; justify-content: space-between; align-items: center; font-size:15px;font-weight:600;margin-bottom:8px;">
                        <span>Quality Score Calculation Example</span>
                        <button id="reloadScoreExampleBtn" title="Show another random model" style="background: none; border: 1px solid var(--gray-300); border-radius: 6px; padding: 2px 6px; cursor: pointer; line-height: 1; transition: all 0.2s ease;" onmouseover="this.style.borderColor='var(--gray-400)'; this.style.backgroundColor='var(--gray-100)';" onmouseout="this.style.borderColor='var(--gray-300)'; this.style.backgroundColor='transparent';">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                        </button>
                    </div>`;

                scoreExampleHtml += '<div class="callout-content" style="padding:0;">';
                
                const displayModelName = randomModelName.split('/').pop();
                scoreExampleHtml += `<div style="font-size:13px;margin-bottom:8px;"><strong>Model:</strong> <span style="font-family:monospace;">${displayModelName}</span> &nbsp; <strong>Template:</strong> <span style="font-family:monospace;">${firstTemplate}</span></div>`;
                
                let totalScore = 0;
                let totalSamples = 0;
                
                scoreExampleHtml += '<table style="width:100%;border-collapse:collapse;font-size:13px;margin-bottom:8px;border-bottom:1.5px solid var(--gray-200);">';
                scoreExampleHtml += '<thead><tr style="background:var(--gray-100);font-size:12px;border-top:1.5px solid var(--gray-200);border-bottom:1.5px solid var(--gray-200);">';
                scoreExampleHtml += '<th style="text-align:left;padding:4px 8px;border-bottom:1.5px solid var(--gray-200);">Type</th>';
                scoreExampleHtml += '<th style="text-align:right;padding:4px 8px;border-bottom:1.5px solid var(--gray-200);">Score</th>';
                scoreExampleHtml += '<th style="text-align:right;padding:4px 8px;border-bottom:1.5px solid var(--gray-200);">Subtotal</th>';
                scoreExampleHtml += '</tr></thead>';
                scoreExampleHtml += '<tbody>';
                
                inputTypeArray.forEach(inputType => {
                    const data = randomModel[firstTemplate][inputType];
                    if (data) {
                        const naFailedCount = (data.NA || 0) + (data.no_result || 0) + (data.inference_failed || 0);
                        const limitedCount = data.limited || 0;
                        const moderateCount = data.moderate || 0;
                        const extensiveCount = data.extensive || 0;
                        
                        const typeScore = (naFailedCount * 3) + (limitedCount * 2) + (moderateCount * 1) + (extensiveCount * 0);
                        totalScore += typeScore;
                        totalSamples += data.total || 0;
                        
                        const typeName = formatTypeName(inputType);
                        scoreExampleHtml += `<tr>`;
                        scoreExampleHtml += `<td style="padding:4px 8px;color:var(--gray-800);">${typeName}</td>`;
                        scoreExampleHtml += `<td style="padding:4px 8px;text-align:right;">`;
                        if (naFailedCount > 0) scoreExampleHtml += `<span style="color:#059669;font-weight:600;">3${naFailedCount}</span> `;
                        if (limitedCount > 0) scoreExampleHtml += `<span style="color:#d97706;font-weight:600;">2${limitedCount}</span> `;
                        if (moderateCount > 0) scoreExampleHtml += `<span style="color:#dc2626;font-weight:600;">1${moderateCount}</span> `;
                        if (extensiveCount > 0) scoreExampleHtml += `<span style="color:#991b1b;font-weight:600;">0${extensiveCount}</span>`;
                        scoreExampleHtml += `</td>`;
                        scoreExampleHtml += `<td style="padding:4px 8px;text-align:right;font-family:monospace;">${typeScore}</td>`;
                        scoreExampleHtml += `</tr>`;
                    }
                });
                scoreExampleHtml += '</tbody></table>';
                
                const averageScore = totalSamples > 0 ? totalScore / totalSamples : 0;
                scoreExampleHtml += `<div style="text-align:right;font-size:13px;margin-bottom:2px;"><strong>Final:</strong> <span style="font-family:monospace;">${totalScore}  ${totalSamples} = <span style='color:#7c3aed;font-weight:700;font-size:15px;'>${averageScore.toFixed(2)}</span></span></div>`;
                scoreExampleHtml += '<div style="font-size:12px;color:var(--gray-600);margin-top:4px;">Higher scores = better at refusing to hallucinate about fake species.</div>';
                scoreExampleHtml += '</div>';
                scoreExampleHtml += '</div>';
            }
        }
        return scoreExampleHtml;
    }

    function renderScoreExample(modelData, templateArray, inputTypeArray) {
        const scoreExampleTarget = document.getElementById('scoreExampleContainer');
        if (!scoreExampleTarget) return;

        scoreExampleTarget.innerHTML = generateScoreExampleHTML(modelData, templateArray, inputTypeArray);
        
        const reloadButton = document.getElementById('reloadScoreExampleBtn');
        if (reloadButton) {
            reloadButton.onclick = () => renderScoreExample(modelData, templateArray, inputTypeArray);
        }
    }
    
    function renderTemplateAnalysisTables(templateArray, inputTypeArray, modelData) {
        let html = '';
        
        // Template descriptions
        const templateDescriptions = {
            'template1_knowlege': 'Basic knowledge level assessment template (limited, moderate, extensive)',
            'template2_knowlege': 'Knowledge level assessment template with NA support', 
            'template3_knowlege': 'Alternative knowledge level assessment template with NA support'
        };
        
        // Create compact table layout for each template
        templateArray.forEach((templateName, templateIndex) => {
            html += `<div class="knowledge-analysis-table-wrapper">`;
            
            // Template header without box
            html += `<div class="template-section-header">`;
            html += `<h3 class="template-section-title">`;
            html += `<a href="/templates" class="template-header-link" onclick="scrollToTemplate('${templateName}')">${templateName}</a>`;
            html += `</h3>`;
            html += `<p class="template-section-description">${templateDescriptions[templateName] || 'Template for model evaluation'}. The bar charts below show response distributions for each model across the artificial species categories.</p>`;
            html += `</div>`;
            
            html += createBarChartLegend();
            
            html += `<div class="table-fade" id="table-fade-${templateIndex}">`;
            html += `<table class="knowledge-analysis-table">`;
            
            // Header row
            html += `<thead><tr>`;
            html += `<th>Model</th>`;
            inputTypeArray.forEach(inputType => {
                const displayType = formatTypeName(inputType);
                html += `<th>${displayType}</th>`;
            });
            html += `<th style="text-align: center; width: 120px;">Quality Score</th>`;
            html += `</tr></thead>`;
            
            // Data rows
            html += `<tbody>`;
            
            // Calculate metrics for sorting
            const modelScores = Object.entries(modelData)
                .filter(([modelName, templates]) => templates[templateName])
                .map(([modelName, templates]) => {
                    let totalQualityScore = 0;
                    let totalSamples = 0;
                    
                    inputTypeArray.forEach(inputType => {
                        const data = templates[templateName][inputType];
                        if (data) {
                            const naFailedCount = (data.NA || 0) + (data.no_result || 0) + (data.inference_failed || 0);
                            const limitedCount = data.limited || 0;
                            const moderateCount = data.moderate || 0;
                            const extensiveCount = data.extensive || 0;
                            
                            totalQualityScore += (naFailedCount * 3) + (limitedCount * 2) + (moderateCount * 1) + (extensiveCount * 0);
                            totalSamples += data.total || 0;
                        }
                    });
                    
                    return {
                        modelName,
                        templates: templates[templateName],
                        qualityScore: totalQualityScore,
                        totalSamples,
                        averageQualityScore: totalSamples > 0 ? totalQualityScore / totalSamples : 0
                    };
                })
                .sort((a, b) => {
                    // Sort by quality score (higher is better)
                    if (b.averageQualityScore !== a.averageQualityScore) {
                        return b.averageQualityScore - a.averageQualityScore;
                    }
                    // Secondary: by total quality score
                    if (b.qualityScore !== a.qualityScore) {
                        return b.qualityScore - a.qualityScore;
                    }
                    // Final fallback: alphabetical by model name
                    return a.modelName.localeCompare(b.modelName);
                });
            
            modelScores.forEach(({modelName, templates, averageQualityScore, qualityScore, totalSamples}, index) => {
                const isHidden = index >= 3;
                html += `<tr class="${isHidden ? 'hidden-row' : ''}">`;
                html += `<td class="model-name-cell">${modelName.split('/').pop()}</td>`;
                
                inputTypeArray.forEach(inputType => {
                    html += `<td class="chart-cell">`;
                    if (templates[inputType]) {
                        html += createKnowledgeBarChart(templates[inputType]);
                    } else {
                        html += '<div class="no-data">No data</div>';
                    }
                    html += `</td>`;
                });
                
                // Add quality score column
                html += `<td class="quality-score-cell">`;
                if (totalSamples > 0) {
                    html += `<span class="quality-score-value">${averageQualityScore.toFixed(2)}</span>`;
                } else {
                    html += '<span style="color: #6c757d; font-style: italic; font-size: 11px;">No data</span>';
                }
                html += `</td>`;
                
                html += `</tr>`;
            });
            html += `</tbody></table>`;
            
            // Add expand/collapse button if there are more than 3 models
            if (modelScores.length > 3) {
                html += `<div class="table-controls">`;
                html += `<button class="expand-button" onclick="toggleTableExpansion(this, ${templateIndex})">`;
                html += `<span>Show ${modelScores.length - 3} more models</span>`;
                html += `<svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">`;
                html += `<path d="M6 9l6 6 6-6"/>`;
                html += `</svg>`;
                html += `</button>`;
                html += `</div>`;
            }
            
            html += `</div>`;
        });
        
        return html;
    }
    
    // Create bar chart for knowledge distribution
    function createKnowledgeBarChart(data) {
        const total = data.total || 0;
        if (total === 0) {
            return '<div class="no-data">No data</div>';
        }
        
        // Calculate percentages
        const segments = [
            { type: 'na', count: data.NA || 0, class: 'knowledge-na' },
            { type: 'limited', count: data.limited || 0, class: 'knowledge-limited' },
            { type: 'moderate', count: data.moderate || 0, class: 'knowledge-moderate' },
            { type: 'extensive', count: data.extensive || 0, class: 'knowledge-extensive' },
            { type: 'failed', count: (data.no_result || 0) + (data.inference_failed || 0), class: 'knowledge-failed' }
        ].filter(seg => seg.count > 0);
        
        let html = '<div class="bar-chart-container">';
        html += '<div class="bar-chart-segments">';
        
        segments.forEach(seg => {
            const percentage = (seg.count / total * 100).toFixed(1);
            const showNumber = seg.count >= 5 || percentage >= 10;
            
            html += `<div class="bar-segment ${seg.class} ${showNumber ? 'show-number' : ''}" 
                        style="width: ${percentage}%"
                        data-count="${seg.count}"
                        data-type="${seg.type}"
                        data-total="${total}"
                        onmouseover="showBarTooltip(event, this)"
                        onmouseout="hideBarTooltip()">`;
            html += `<span class="bar-number">${seg.count}</span>`;
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';
        
        return html;
    }
    
    // Bar tooltip functions
    let barTooltip = null;
    
    function showBarTooltip(event, element) {
        const count = element.getAttribute('data-count');
        const type = element.getAttribute('data-type');
        const total = element.getAttribute('data-total');
        const percentage = ((parseFloat(count) / parseFloat(total)) * 100).toFixed(1);
        
        // Hide any existing tooltip
        hideBarTooltip();
        
        // Create tooltip
        barTooltip = document.createElement('div');
        barTooltip.className = 'bar-tooltip';
        barTooltip.style.cssText = `
            position: fixed;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            white-space: nowrap;
        `;
        
        const typeLabels = {
            'na': 'NA/Unknown',
            'limited': 'Limited',
            'moderate': 'Moderate',
            'extensive': 'Extensive',
            'failed': 'Failed/No Result'
        };
        
        barTooltip.textContent = `${typeLabels[type] || type}: ${count} (${percentage}%)`;
        document.body.appendChild(barTooltip);
        
        // Position tooltip
        const rect = element.getBoundingClientRect();
        const tooltipRect = barTooltip.getBoundingClientRect();
        
        let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
        let top = rect.top - tooltipRect.height - 8;
        
        // Ensure tooltip stays on screen
        if (left < 10) left = 10;
        if (left + tooltipRect.width > window.innerWidth - 10) {
            left = window.innerWidth - tooltipRect.width - 10;
        }
        if (top < 10) {
            top = rect.bottom + 8;
        }
        
        barTooltip.style.left = left + 'px';
        barTooltip.style.top = top + 'px';
    }
    
    function hideBarTooltip() {
        if (barTooltip) {
            barTooltip.remove();
            barTooltip = null;
        }
    }
    
    // --- End Knowledge Analysis Data Fetch and Render ---
    
    // Initialize all animations
    // Comment out undefined functions that were causing errors
    // initPhenotypeAnimation();
    // initKnowledgeAnimation();
    // initGrowthAnimation();
    
    // Load knowledge analysis data after DOM is ready
    loadKnowledgeAnalysisData();
    
    // Load correlation data for real species
    loadCorrelationData();
    
    function animateFlowDiagram(diagram) {
        const queryTemplates = diagram.querySelectorAll('.query-template');
        const outputOptions = diagram.querySelectorAll('.output-option');
        
        if (queryTemplates.length === 0 || outputOptions.length === 0) {
            console.error('Flow diagram animation: Could not find query or output elements for a diagram.');
            return;
        }
        
        function resetHighlights() {
            queryTemplates.forEach(q => q.classList.remove('active'));
            outputOptions.forEach(o => o.classList.remove('highlight'));
            diagram.querySelectorAll('.expectation-indicator span').forEach(span => {
                span.style.display = 'none';
            });
        }
        
        const animations = [
            { query: '1', output: 'limited', duration: 3000 },
            { query: '2', output: 'na', duration: 3000 },
            { query: '3', output: 'na', duration: 3000 }
        ];
        
        let currentIndex = 0;
        
        function showNext() {
            resetHighlights();
            
            const current = animations[currentIndex];
            const queryElement = diagram.querySelector(`.query-template[data-query="${current.query}"]`);
            const outputElement = diagram.querySelector(`.output-option[data-level="${current.output}"]`);
            const naOption = diagram.querySelector('.output-option[data-level="na"]');

            // Show/hide NA option based on query with smooth transition
            if (current.query === '1') {
                if (naOption) {
                    naOption.classList.add('hide');
                }
            } else {
                if (naOption) {
                    naOption.classList.remove('hide');
                }
            }

            if (queryElement && outputElement) {
                queryElement.classList.add('active');
                
                setTimeout(() => {
                    outputElement.classList.add('highlight');
                    const expectIndicator = outputElement.querySelector(`.expect-q${current.query}`);
                    if (expectIndicator) {
                        expectIndicator.style.display = 'inline-block';
                    }
                }, 500);
            }
            
            currentIndex = (currentIndex + 1) % animations.length;
            setTimeout(showNext, current.duration);
        }
        
        // Start with a delay to let other things settle
        setTimeout(showNext, 1500 + Math.random() * 500);
    }

    // Flow Diagram Animation - Run after a delay to ensure DOM is ready
    setTimeout(function() {
        const diagrams = document.querySelectorAll('.experimental-flow-section .flow-diagram');
        console.log(`Found ${diagrams.length} flow diagrams to animate.`);
        diagrams.forEach((diagram, index) => {
            console.log(`Initializing animation for diagram ${index + 1}.`);
            animateFlowDiagram(diagram);
        });
    }, 1000);
    
    // Correlation Flow Animation
    function animateCorrelationFlow() {
        const flowGrid = document.querySelector('.flow-grid');
        if (!flowGrid) return;
        
        const speciesBox = flowGrid.querySelector('.flow-species');
        const llmBox = flowGrid.querySelector('#corr-llm-box');
        const webBox = flowGrid.querySelector('#corr-web-box');
        const arrows = flowGrid.querySelectorAll('.flow-arrow');
        const correlationBox = flowGrid.querySelector('.grid-correlation');
        
        const species = [
            { name: 'Bacillus subtilis', knowledge: 'Limited', webCount: '1.5 M' },
            { name: 'Escherichia coli', knowledge: 'Extensive', webCount: '45.2 M' },
            { name: 'Streptococcus pyogenes', knowledge: 'Moderate', webCount: '8.7 M' },
            { name: 'Mycobacterium tuberculosis', knowledge: 'Extensive', webCount: '23.1 M' }
        ];
        
        let currentIndex = 0;
        
        function resetHighlights() {
            arrows.forEach(arrow => arrow.classList.remove('active'));
            llmBox.classList.remove('highlight');
            webBox.classList.remove('highlight');
            correlationBox.classList.remove('highlight');
        }
        
        function animateStep() {
            resetHighlights();
            const current = species[currentIndex];
            
            // Update species name
            speciesBox.textContent = current.name;
            
            // Step 1: Highlight species to LLM path
            setTimeout(() => {
                arrows[0].classList.add('active'); // Top left arrow
                arrows[1].classList.add('active'); // Top middle arrow
                llmBox.classList.add('highlight');
                
                // Update LLM result
                const knowledgeSpan = llmBox.querySelector('.output-option');
                if (knowledgeSpan) {
                    knowledgeSpan.textContent = current.knowledge;
                    knowledgeSpan.className = 'output-option';
                    
                    // Add the appropriate background styling based on knowledge level
                    if (current.knowledge === 'Limited') {
                        knowledgeSpan.style.background = 'linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%)';
                        knowledgeSpan.style.color = '#856404';
                        knowledgeSpan.style.borderColor = 'rgba(255, 193, 7, 0.3)';
                    } else if (current.knowledge === 'Moderate') {
                        knowledgeSpan.style.background = 'linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%)';
                        knowledgeSpan.style.color = '#0c5460';
                        knowledgeSpan.style.borderColor = 'rgba(23, 162, 184, 0.3)';
                    } else if (current.knowledge === 'Extensive') {
                        knowledgeSpan.style.background = 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)';
                        knowledgeSpan.style.color = '#155724';
                        knowledgeSpan.style.borderColor = 'rgba(40, 167, 69, 0.3)';
                    }
                }
            }, 300);
            
            // Step 2: Highlight species to web search path
            setTimeout(() => {
                arrows[3].classList.add('active'); // Bottom left arrow
                arrows[4].classList.add('active'); // Bottom middle arrow
                webBox.classList.add('highlight');
                webBox.textContent = current.webCount;
            }, 800);
            
            // Step 3: Highlight correlation
            setTimeout(() => {
                arrows[2].classList.add('active'); // Top right arrow
                arrows[5].classList.add('active'); // Bottom right arrow
                correlationBox.classList.add('highlight');
            }, 1300);
            
            currentIndex = (currentIndex + 1) % species.length;
            setTimeout(animateStep, 4000);
        }
        
        // Start animation
        setTimeout(animateStep, 1500);
    }
    
    // Initialize correlation animation
    setTimeout(animateCorrelationFlow, 1200);
});

// Function to scroll to template on templates page
function scrollToTemplate(templateName) {
    // Store the template name to scroll to after page loads
    sessionStorage.setItem('scrollToTemplate', templateName);
}

// Make bar tooltip functions globally available
window.showBarTooltip = showBarTooltip;
window.hideBarTooltip = hideBarTooltip;

// Toggle table expansion
function toggleTableExpansion(button, templateIndex) {
    const tableWrapper = button.closest('.knowledge-analysis-table-wrapper');
    const hiddenRows = tableWrapper.querySelectorAll('.hidden-row');
    const fadeContainer = tableWrapper.querySelector(`#table-fade-${templateIndex}`);
    const isExpanded = button.classList.contains('expanded');
    
    if (isExpanded) {
        // Collapse
        hiddenRows.forEach(row => row.classList.remove('show'));
        button.classList.remove('expanded');
        button.querySelector('span').textContent = `Show ${hiddenRows.length} more models`;
        if (fadeContainer) fadeContainer.classList.remove('expanded');
    } else {
        // Expand
        hiddenRows.forEach(row => row.classList.add('show'));
        button.classList.add('expanded');
        button.querySelector('span').textContent = 'Show less';
        if (fadeContainer) fadeContainer.classList.add('expanded');
    }
}

// --- Real Species Correlation Data Fetch and Render ---
// Call this function after the main DOMContentLoaded handler
window.loadCorrelationData = loadCorrelationData;

function loadCorrelationData() {
    const container = document.getElementById('correlationContent');
    if (!container) return;
    console.log('Starting to load correlation data...');
    container.innerHTML = `<div class="loading-container"><div class="loading-progress"><div class="loading-progress-bar"></div></div><div class="loading-text">Loading knowledge-web alignment data...</div></div>`;
    
    fetch('/api/search_count_correlation')
        .then(response => {
            console.log('Response status:', response.status);
            console.log('Response ok:', response.ok);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Correlation data received:', data);
            if (data.error) {
                container.innerHTML = `<div class='empty-state'><h3>Error loading correlation data</h3><p>${data.error}</p></div>`;
                return;
            }
            if (!data.files_with_search_counts || data.files_with_search_counts.length === 0) {
                container.innerHTML = `<div class='empty-state'><h3>No datasets with search counts found</h3><p>Upload a CSV file with a "Search Count" column to see correlation analysis.</p></div>`;
                return;
            }
            renderCorrelationSummary(data);
            renderCorrelationStatsAndTable(data, container);
        })
        .catch(error => {
            console.error('Error loading correlation data:', error);
            container.innerHTML = `<div class='empty-state'><h3>Error loading data</h3><p>${error.message}</p></div>`;
        });
}

function renderCorrelationSummary(data) {
    const selectedDataset = data.files_with_search_counts[0];
    const fileData = data.correlation_data[selectedDataset];
    let modelResults = [];
    Object.entries(fileData).forEach(([templateName, models]) => {
        Object.entries(models).forEach(([modelName, d]) => {
            if (d.species_count < 2) return;
            modelResults.push({
                modelName,
                templateName,
                correlation: d.correlation_coefficient,
            });
        });
    });
    // Sort by correlation descending
    modelResults.sort((a, b) => b.correlation - a.correlation);
    
    const totalModels = new Set(modelResults.map(r => r.modelName)).size;
    const totalTemplates = Object.keys(fileData).length;
    const maxCorrelation = modelResults.length ? Math.max(...modelResults.map(m => m.correlation)) : 0;
    const minCorrelation = modelResults.length ? Math.min(...modelResults.map(m => m.correlation)) : 0;
    const bestModelResult = modelResults.length ? modelResults.find(m => m.correlation === maxCorrelation) : null;
    const worstModelResult = modelResults.length ? modelResults.find(m => m.correlation === minCorrelation) : null;
    
    const bestModel = bestModelResult ? bestModelResult.modelName.split('/').pop() : 'N/A';
    const worstModel = worstModelResult ? worstModelResult.modelName.split('/').pop() : 'N/A';
    
    const dynamicStatsText =
        `Our analysis of web-aligned knowledge across <span class="stat-value">${totalModels}</span> models and <span class="stat-value">${totalTemplates}</span> templates reveals how well each model's confidence aligns with real-world information availability. ` +
        `Models with higher correlation scores demonstrate better calibrationthey claim extensive knowledge for well-documented bacteria and limited knowledge for obscure species. ` +
        (bestModelResult ? `The best alignment was achieved by <span class="model-highlight">${bestModel}</span> with a correlation coefficient of <span class="stat-value">${maxCorrelation.toFixed(3)}</span>, ` +
        `indicating its knowledge claims closely match the actual web presence of bacterial species. ` : '') +
        (worstModel && bestModel !== worstModel ? `In contrast, <span class="model-lowlight">${worstModel}</span> showed the weakest alignment with a correlation of <span class="stat-value">${minCorrelation.toFixed(3)}</span>, ` +
        `suggesting its confidence assessments are less reflective of real-world information availability.` : '');

    const correlationStatsDiv = document.getElementById('correlationDynamicStats');
    if (correlationStatsDiv) {
        correlationStatsDiv.innerHTML = `<p>${dynamicStatsText}</p>`;
    }
}

function renderCorrelationStatsAndTable(data, container) {
    // Use the first dataset with search counts
    const selectedDataset = data.files_with_search_counts[0];
    const fileData = data.correlation_data[selectedDataset];
    let modelResults = [];
    Object.entries(fileData).forEach(([templateName, models]) => {
        Object.entries(models).forEach(([modelName, d]) => {
            if (d.species_count < 2) return;
            modelResults.push({
                modelName,
                templateName,
                correlation: d.correlation_coefficient,
                speciesCount: d.species_count,
                knowledgeDist: d.knowledge_distribution,
                dataPoints: d.data_points
            });
        });
    });
    // Sort by correlation descending
    modelResults.sort((a, b) => b.correlation - a.correlation);
    
    // ========================
    // NEW: Top performers call-out (Correlation)
    // ========================
    const top4CorrModels = modelResults.slice(0, 4);
    let corrTopPerformersHtml = "";
    if (top4CorrModels.length > 0) {
        corrTopPerformersHtml += `\n            <div class="top-performers-section" style="margin-bottom: 48px; margin-top: 32px;">\n                <h3 class="section-title" style="text-align: left; font-size: 24px; margin-bottom: 8px;">Top Models  Web-Alignment</h3>\n                <p class="article-text" style="margin-bottom: 24px;">Based on the Pearson correlation between claimed knowledge and Google search counts, these models show the strongest calibration to real-world information availability.</p>\n                ${createBarChartLegend()}\n                <div class="performers-list">`;

        top4CorrModels.forEach((m, idx) => {
            const displayName = m.modelName.split('/').pop();
            corrTopPerformersHtml += `\n                    <div class="performer-card-simple">\n                        <div class="performer-rank">${idx + 1}</div>\n                        <div style="flex: 1;">\n                            <div class="performer-name">${displayName}</div>\n                            <div class="performer-score">Correlation: <strong>${m.correlation.toFixed(3)}</strong></div>\n                            <div class="performer-dist-chart" style="margin-top: 12px;">\n                                ${renderKnowledgeDistBar(m.knowledgeDist, m.speciesCount)}\n                            </div>\n                        </div>\n                    </div>`;
        });

        corrTopPerformersHtml += `\n                </div>\n            </div>`;
    }

    // Table
    let html = corrTopPerformersHtml + `<div class="knowledge-analysis-table-wrapper">`;
    html += `<div class="template-section-header"><h3 class="template-section-title">Knowledge-Web Alignment Table</h3><p class="template-section-description">Correlation between LLM knowledge claims and web presence for real species. The bar charts below show the distribution of self-reported knowledge levels for each model.</p></div>`;
    html += createBarChartLegend();
    html += `<table class="knowledge-analysis-table">`;
    html += `<thead><tr><th>Model</th><th>Template</th><th>Knowledge Distribution</th><th>Species</th><th>Correlation</th></tr></thead><tbody>`;
    modelResults.forEach(m => {
        html += `<tr>`;
        html += `<td class="model-name-cell">${m.modelName.split('/').pop()}</td>`;
        html += `<td>${m.templateName}</td>`;
        html += `<td class="chart-cell" data-model="${m.modelName}" data-correlation="${m.correlation}" data-points='${JSON.stringify(m.dataPoints)}' onmouseover="showDistributionTooltip(event, this)" onmouseout="hideDistributionTooltip()">${renderKnowledgeDistBar(m.knowledgeDist, m.speciesCount)}</td>`;
        html += `<td style="text-align:center;">${m.speciesCount}</td>`;
        html += `<td style="text-align:center;font-weight:600;">${m.correlation.toFixed(3)}</td>`;
        html += `</tr>`;
    });
    html += `</tbody></table></div>`;
    container.innerHTML = html;
}

function renderKnowledgeDistBar(dist, total) {
    if (!total || total === 0) return '<div class="no-data">No data</div>';
    const segments = [
        { type: 'limited', count: dist.limited || 0, class: 'knowledge-limited' },
        { type: 'moderate', count: dist.moderate || 0, class: 'knowledge-moderate' },
        { type: 'extensive', count: dist.extensive || 0, class: 'knowledge-extensive' },
        { type: 'NA', count: dist.NA || 0, class: 'knowledge-na' }
    ].filter(seg => seg.count > 0);
    let html = '<div class="bar-chart-container"><div class="bar-chart-segments">';
    segments.forEach(seg => {
        const pct = (seg.count / total * 100).toFixed(1);
        html += `<div class="bar-segment ${seg.class}" style="width:${pct}%">${pct > 10 ? seg.count : ''}</div>`;
    });
    html += '</div></div>';
    return html;
}

function createBarChartLegend() {
    return `
        <div style="display: flex; flex-wrap: wrap; gap: 16px; align-items: center; margin-bottom: 16px; margin-top: 4px; padding-left: 4px;">
            <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model can provide in-depth, reference-level information.">
                <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);"></div>
                <span>Extensive</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model can give several specific details.">
                <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);"></div>
                <span>Moderate</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model knows only basic facts or context.">
                <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);"></div>
                <span>Limited</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model doesn't know or no information available.">
                <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);"></div>
                <span>NA</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--gray-700);" title="Model failed to generate a response or the response was not valid.">
                <div style="width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);"></div>
                <span>Failed</span>
            </div>
        </div>
    `;
}
</script>

</div> <!-- Close main-content -->
{% endblock %} 